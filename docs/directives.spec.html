<!DOCTYPE html>

<html>
<head>
  <title>directives.spec.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.coffee
              </a>
            
              
              <a class="source" href="app.config.html">
                app.config.coffee
              </a>
            
              
              <a class="source" href="app.controllers.html">
                app.controllers.coffee
              </a>
            
              
              <a class="source" href="app.directives.html">
                app.directives.coffee
              </a>
            
              
              <a class="source" href="app.services.AnalysisService.html">
                app.services.AnalysisService.coffee
              </a>
            
              
              <a class="source" href="app.services.EditorService.html">
                app.services.EditorService.coffee
              </a>
            
              
              <a class="source" href="app.services.EntityService.html">
                app.services.EntityService.coffee
              </a>
            
              
              <a class="source" href="app.services.html">
                app.services.coffee
              </a>
            
              
              <a class="source" href="EntitiesController.spec.html">
                EntitiesController.spec.coffee
              </a>
            
              
              <a class="source" href="controllers.error.spec.html">
                controllers.error.spec.coffee
              </a>
            
              
              <a class="source" href="directives.spec.html">
                directives.spec.coffee
              </a>
            
              
              <a class="source" href="services.spec.html">
                services.spec.coffee
              </a>
            
              
              <a class="source" href="tinymce.spec.html">
                tinymce.spec.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>directives.spec.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-string">'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Test directives.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe <span class="hljs-string">'directives'</span>,<span class="hljs-function"> -&gt;</span>
  beforeEach <span class="hljs-built_in">module</span>(<span class="hljs-string">'wordlift.tinymce.plugin.directives'</span>)
  beforeEach <span class="hljs-built_in">module</span>(<span class="hljs-string">'AnalysisService'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Test the wlEntity directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe <span class="hljs-string">'wlEntity'</span>,<span class="hljs-function"> -&gt;</span>
    scope = <span class="hljs-literal">undefined</span>
    element = <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Get the root scope and create a wl-entities element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    beforeEach inject<span class="hljs-function"><span class="hljs-params">(($rootScope) -&gt;

      scope = $rootScope.$<span class="hljs-keyword">new</span>()

</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The wlEntities directive gets the annotation from the text-annotation attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      element = angular.element <span class="hljs-string">'&lt;wl-entity on-select="select(entityAnnotation)" entity-annotation="entityAnnotation"&gt;&lt;/wl-entities&gt;'</span>
    )

    it <span class="hljs-string">'fires the select method with the entityAnnotation'</span>, inject<span class="hljs-function"><span class="hljs-params">(($compile) -&gt;
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Create a mock entity annotation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scope.entityAnnotation = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create a mock select method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scope.<span class="hljs-function"><span class="hljs-title">select</span> = <span class="hljs-params">(item)</span> -&gt;</span> <span class="hljs-comment"># Do nothing</span>
      spyOn scope, <span class="hljs-string">'select'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Compile the directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $compile(element)(scope)
      scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Simulate the click on the element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      element.children()[<span class="hljs-number">0</span>].click()</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Check that the select event has been called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      expect(scope.select).toHaveBeenCalledWith(scope.entityAnnotation)
    )</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Test the wlEntities directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe <span class="hljs-string">'wlEntities'</span>,<span class="hljs-function"> -&gt;</span>
    scope = <span class="hljs-literal">undefined</span>
    element = <span class="hljs-literal">undefined</span>
    EntitiesController = <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Get the root scope and create a wl-entities element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    beforeEach inject<span class="hljs-function"><span class="hljs-params">(($rootScope, $controller) -&gt;

</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Create a new scope, the scope will be shared between the entities controller and the wlEntities directive,
as in the HTML the textAnnotation is passed using the ‘textAnnotation’ property of the EntitiesController
scope.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scope = $rootScope.$<span class="hljs-keyword">new</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Create the EntitiesController with the new scope.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      EntitiesController = $controller <span class="hljs-string">'EntitiesController'</span>, { <span class="hljs-attribute">$scope</span>: scope }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>The wlEntities directive gets the annotation from the text-annotation attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      element = angular.element <span class="hljs-string">'&lt;wl-entities on-select="select(textAnnotation, entityAnnotation)" text-annotation="textAnnotation"&gt;&lt;/wl-entities&gt;'</span>
    )</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Test for the entity to empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it <span class="hljs-string">'should be empty'</span>, inject<span class="hljs-function"><span class="hljs-params">(($compile) -&gt;

</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Compile the directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $compile(element)(scope)
      scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Check that there’s an empty list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      expect(element.find(<span class="hljs-string">'ul'</span>).length).toEqual <span class="hljs-number">1</span>
      expect(element.find(<span class="hljs-string">'li'</span>).length).toEqual <span class="hljs-number">0</span>
    )</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Test entity is not empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it <span class="hljs-string">'should not be empty'</span>, inject<span class="hljs-function"><span class="hljs-params">(($compile, $rootScope, AnalysisService, $httpBackend) -&gt;
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Create a mock select method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scope.<span class="hljs-function"><span class="hljs-title">select</span> = <span class="hljs-params">(ta, ea)</span> -&gt;</span> <span class="hljs-comment"># Do nothing</span>
      spyOn scope, <span class="hljs-string">'select'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Compile the directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $compile(element)(scope)
      scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Get the mock-up analysis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.ajax(<span class="hljs-string">'base/app/assets/english.json'</span>,
        <span class="hljs-attribute">async</span>: <span class="hljs-literal">false</span>
      ).done <span class="hljs-function"><span class="hljs-params">(data)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Catch all the requests to Freebase.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $httpBackend.<span class="hljs-keyword">when</span>(<span class="hljs-string">'HEAD'</span>, <span class="hljs-regexp">/.*/</span>).respond(<span class="hljs-number">200</span>, <span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Simulate event broadcasted by AnalysisService</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'analysisReceived'</span>, AnalysisService.parse data</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Create a fake textAnnotation element (the textAnnotation exists in the mockup data).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotation = angular.element <span class="hljs-string">'&lt;span id="urn:enhancement-233fd158-870d-6ca4-b7ce-30313e4a7015" class="textannotation"&gt;David Riccitelli&lt;/span&gt;'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Simulate event broadcasted by EditorService on annotation click</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'textAnnotationClicked'</span>, textAnnotation.attr(<span class="hljs-string">'id'</span>), { <span class="hljs-attribute">target</span>: textAnnotation }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Process changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Check that there are 2 entity tiles.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entitiesElems = element.find(<span class="hljs-string">'wl-entity &gt; div'</span>)
        expect(entitiesElems.length).toEqual <span class="hljs-number">3</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Set the ID of the entity annotations (from the mock file).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        id1 = <span class="hljs-string">'urn:enhancement-3a64853f-2f48-c749-0073-c5787acf3b0e'</span>
        id2 = <span class="hljs-string">'urn:enhancement-26a923a4-fbb8-b39d-53ad-e2922474b7fc'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Click the first entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entitiesElems[<span class="hljs-number">1</span>].click()
        expect(scope.textAnnotation.entityAnnotations[id1].selected).toBe <span class="hljs-literal">true</span>
        expect(scope.textAnnotation.entityAnnotations[id2].selected).toBe <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Check that the select event has been called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(scope.select).toHaveBeenCalledWith(scope.textAnnotation, scope.textAnnotation.entityAnnotations[id1])</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Click on the second entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entitiesElems[<span class="hljs-number">2</span>].click()
        expect(scope.textAnnotation.entityAnnotations[id1].selected).toBe <span class="hljs-literal">false</span>
        expect(scope.textAnnotation.entityAnnotations[id2].selected).toBe <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Check that the select event has been called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(scope.select).toHaveBeenCalledWith(scope.textAnnotation, scope.textAnnotation.entityAnnotations[id2])</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Click again on the second entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entitiesElems[<span class="hljs-number">2</span>].click()
        expect(scope.textAnnotation.entityAnnotations[id1].selected).toBe <span class="hljs-literal">false</span>
        expect(scope.textAnnotation.entityAnnotations[id2].selected).toBe <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Check that the select event has been called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(scope.select).toHaveBeenCalledWith(scope.textAnnotation, <span class="hljs-literal">null</span>)

    )</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Test entity is not empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it <span class="hljs-string">'works well with entity annotations that relate to one or more text annotation'</span>, inject<span class="hljs-function"><span class="hljs-params">(($compile, $rootScope, AnalysisService, $httpBackend) -&gt;
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Create a mock select method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scope.<span class="hljs-function"><span class="hljs-title">select</span> = <span class="hljs-params">(ta, ea)</span> -&gt;</span> <span class="hljs-comment"># Do nothing</span>
      spyOn scope, <span class="hljs-string">'select'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Compile the directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $compile(element)(scope)
      scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Get the mock-up analysis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.ajax(<span class="hljs-string">'base/app/assets/sparql.json'</span>,
        <span class="hljs-attribute">async</span>: <span class="hljs-literal">false</span>
      ).done <span class="hljs-function"><span class="hljs-params">(data)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Catch all the requests to Freebase.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $httpBackend.<span class="hljs-keyword">when</span>(<span class="hljs-string">'HEAD'</span>, <span class="hljs-regexp">/.*/</span>).respond(<span class="hljs-number">200</span>, <span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Simulate event broadcasted by AnalysisService</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'analysisReceived'</span>, AnalysisService.parse data, <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Create a fake textAnnotation element (the textAnnotation exists in the mockup data).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        elements = []
        elements[<span class="hljs-number">0</span>] = angular.element <span class="hljs-string">'&lt;span id="urn:enhancement-d791d926-23e9-61f9-7b67-6414586bc49e" class="textannotation"&gt;Lorem Ipsum&lt;/span&gt;'</span>
        elements[<span class="hljs-number">1</span>] = angular.element <span class="hljs-string">'&lt;span id="urn:enhancement-9de365a0-3312-4927-0cbd-8735d460901d" class="textannotation"&gt;Lorem Ipsum&lt;/span&gt;'</span>
        elements[<span class="hljs-number">2</span>] = angular.element <span class="hljs-string">'&lt;span id="urn:enhancement-aaf7f73e-910a-3516-1f58-d5c41c42ab0b" class="textannotation"&gt;Lorem Ipsum&lt;/span&gt;'</span>

        entityAnnotations = []
        entityAnnotations[<span class="hljs-number">0</span>] = <span class="hljs-string">'urn:enhancement-ee057616-a5b7-e0c1-1111-24d2304417ff'</span>
        entityAnnotations[<span class="hljs-number">1</span>] = <span class="hljs-string">'urn:enhancement-1c03bb72-6cfe-3dfc-ad7f-3082a5ce086b'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Simulate event broadcasted by EditorService on annotation click</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'textAnnotationClicked'</span>, elements[<span class="hljs-number">0</span>].attr(<span class="hljs-string">'id'</span>), { <span class="hljs-attribute">target</span>: elements[<span class="hljs-number">0</span>] }
        scope.$digest()

        entities = element.find(<span class="hljs-string">'wl-entity &gt; div'</span>)
        expect(entities.length).toEqual <span class="hljs-number">2</span>

        entities[<span class="hljs-number">0</span>].click()</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Simulate event broadcasted by EditorService on annotation click</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'textAnnotationClicked'</span>, elements[<span class="hljs-number">1</span>].attr(<span class="hljs-string">'id'</span>), { <span class="hljs-attribute">target</span>: elements[<span class="hljs-number">1</span>] }
        scope.$digest()

        entities = element.find(<span class="hljs-string">'wl-entity &gt; div'</span>)
        expect(entities.length).toEqual <span class="hljs-number">1</span>

        entities[<span class="hljs-number">0</span>].click()</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Simulate event broadcasted by EditorService on annotation click</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'textAnnotationClicked'</span>, elements[<span class="hljs-number">2</span>].attr(<span class="hljs-string">'id'</span>), { <span class="hljs-attribute">target</span>: elements[<span class="hljs-number">2</span>] }
        scope.$digest()

        entities = element.find(<span class="hljs-string">'wl-entity &gt; div'</span>)
        expect(entities.length).toEqual <span class="hljs-number">3</span>

        <span class="hljs-keyword">for</span> id, entityAnnotation <span class="hljs-keyword">of</span> scope.textAnnotation.entityAnnotations
          expect(entityAnnotation.selected).toBe <span class="hljs-literal">false</span>

    )

  describe <span class="hljs-string">'wlEntityInputBoxes'</span>,<span class="hljs-function"> -&gt;</span>
    scope = <span class="hljs-literal">undefined</span>
    element = <span class="hljs-literal">undefined</span>
    EntitiesController = <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Get the root scope and create a wl-entities element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    beforeEach inject<span class="hljs-function"><span class="hljs-params">(($rootScope, $controller) -&gt;

</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Create a new scope, the scope will be shared between the entities controller and the wlEntities directive,
as in the HTML the textAnnotation is passed using the ‘textAnnotation’ property of the EntitiesController
scope.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scope = $rootScope.$<span class="hljs-keyword">new</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Create the EntitiesController with the new scope.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      EntitiesController = $controller <span class="hljs-string">'EntitiesController'</span>, { <span class="hljs-attribute">$scope</span>: scope }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>The wlEntities directive gets the annotation from the text-annotation attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      element = angular.element <span class="hljs-string">'&lt;wl-entity-input-boxes text-annotations="analysis.textAnnotations"&gt;&lt;/wl-entity-input-boxes&gt;'</span>
    )</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Test for the entity to empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it <span class="hljs-string">'creates input boxes and textareas with entity data (non-merged)'</span>, inject<span class="hljs-function"><span class="hljs-params">((AnalysisService, $compile, $httpBackend, $rootScope) -&gt;

</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Compile the directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $compile(element)(scope)
      scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Get the mock-up analysis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.ajax(<span class="hljs-string">'base/app/assets/english.json'</span>,
        <span class="hljs-attribute">async</span>: <span class="hljs-literal">false</span>
      ).done <span class="hljs-function"><span class="hljs-params">(data)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Catch all the requests to Freebase.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $httpBackend.<span class="hljs-keyword">when</span>(<span class="hljs-string">'HEAD'</span>, <span class="hljs-regexp">/.*/</span>).respond(<span class="hljs-number">200</span>, <span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Simulate event broadcasted by AnalysisService</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'analysisReceived'</span>, AnalysisService.parse data</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Check that the analysis is set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(scope.analysis).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span>
        expect(scope.analysis.textAnnotations).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">0</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Select a text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotation1 = scope.analysis.textAnnotations[<span class="hljs-string">'urn:enhancement-1a452dcd-b97f-6d9c-8de5-b4cec57ec020'</span>]
        expect(textAnnotation1).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Select an entity annotation in the first text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1 = textAnnotation1.entityAnnotations[<span class="hljs-string">'urn:enhancement-ec266952-de23-ef06-896f-02f9434e99b0'</span>]
        expect(entityAnnotation1).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Select one entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fieldName1 = <span class="hljs-string">"wl_entities\\[<span class="hljs-subst">#{entityAnnotation1.entity.id}</span>\\]"</span>
        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">9</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">1</span>

        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[uri\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.id
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[label\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.label
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[type\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.type
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.thumbnails[<span class="hljs-number">0</span>]
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">1</span>].value).toEqual entityAnnotation1.entity.thumbnails[<span class="hljs-number">1</span>]
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">2</span>].value).toEqual entityAnnotation1.entity.thumbnails[<span class="hljs-number">2</span>]
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">3</span>].value).toEqual entityAnnotation1.entity.thumbnails[<span class="hljs-number">3</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Get the decoded description and check it against the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        description = $(element.find(<span class="hljs-string">"textarea[name='<span class="hljs-subst">#{fieldName1}</span>\\[description\\]']"</span>)[<span class="hljs-number">0</span>]).text()
        expect(description).toEqual entityAnnotation1.entity.description</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Deselect the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">false</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Check that no inputs are selected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">0</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Reselect the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Select a text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotation2 = scope.analysis.textAnnotations[<span class="hljs-string">'urn:enhancement-233fd158-870d-6ca4-b7ce-30313e4a7015'</span>]
        expect(textAnnotation2).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Select an entity annotation in the first text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation2 = textAnnotation2.entityAnnotations[<span class="hljs-string">'urn:enhancement-26a923a4-fbb8-b39d-53ad-e2922474b7fc'</span>]
        expect(entityAnnotation2).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Select another entity in the same text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation2.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Check that the number of inputs matches.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">15</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fieldName2 = <span class="hljs-string">"wl_entities\\[<span class="hljs-subst">#{entityAnnotation2.entity.id}</span>\\]"</span>

        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[uri\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.id
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[label\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.label
        expect(element.find(<span class="hljs-string">"textarea[name='<span class="hljs-subst">#{fieldName2}</span>\\[description\\]']"</span>)[<span class="hljs-number">0</span>].innerHTML).toEqual entityAnnotation2.entity.description
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[type\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.type
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.thumbnails[<span class="hljs-number">0</span>]

    )</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Test for the entity to empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it <span class="hljs-string">'creates input boxes and textareas with entity data (merged)'</span>, inject<span class="hljs-function"><span class="hljs-params">((AnalysisService, $compile, $httpBackend, $rootScope) -&gt;

</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Compile the directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $compile(element)(scope)
      scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Get the mock-up analysis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.ajax(<span class="hljs-string">'base/app/assets/english.json'</span>,
        <span class="hljs-attribute">async</span>: <span class="hljs-literal">false</span>
      ).done <span class="hljs-function"><span class="hljs-params">(data)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Catch all the requests to Freebase.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $httpBackend.<span class="hljs-keyword">when</span>(<span class="hljs-string">'HEAD'</span>, <span class="hljs-regexp">/.*/</span>).respond(<span class="hljs-number">200</span>, <span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Simulate event broadcasted by AnalysisService</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'analysisReceived'</span>, AnalysisService.parse data, <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Check that the analysis is set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(scope.analysis).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span>
        expect(scope.analysis.textAnnotations).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">0</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Select a text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotation1 = scope.analysis.textAnnotations[<span class="hljs-string">'urn:enhancement-1a452dcd-b97f-6d9c-8de5-b4cec57ec020'</span>]
        expect(textAnnotation1).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Select an entity annotation in the first text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1 = textAnnotation1.entityAnnotations[<span class="hljs-string">'urn:enhancement-90a5f78d-7f4d-04fa-70df-fbb0e9aa212d'</span>]
        expect(entityAnnotation1).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Select one entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fieldName1 = <span class="hljs-string">"wl_entities\\[<span class="hljs-subst">#{entityAnnotation1.entity.id}</span>\\]"</span>
        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">9</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">1</span>

        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[uri\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.id
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[label\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.label
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[type\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.type

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..entityAnnotation1.entity.thumbnails.length]
          expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[i].value).toEqual entityAnnotation1.entity.thumbnails[i]

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..entityAnnotation1.entity.sameAs.length]
          expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[sameas\\]\\[\\]']"</span>)[i].value).toEqual entityAnnotation1.entity.sameAs[i]</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Get the decoded description and check it against the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        description = $(element.find(<span class="hljs-string">"textarea[name='<span class="hljs-subst">#{fieldName1}</span>\\[description\\]']"</span>)[<span class="hljs-number">0</span>]).text()
        expect(description).toEqual entityAnnotation1.entity.description</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Deselect the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">false</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Check that no inputs are selected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">0</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Reselect the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Select a text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotation2 = scope.analysis.textAnnotations[<span class="hljs-string">'urn:enhancement-233fd158-870d-6ca4-b7ce-30313e4a7015'</span>]
        expect(textAnnotation2).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <pre><code>   dump <span class="hljs-string">"[ id :: <span class="hljs-subst">#{id}</span> ][ entity id :: <span class="hljs-subst">#{entityAnnotation.entity.id}</span> ]"</span> <span class="hljs-keyword">for</span> id, entityAnnotation <span class="hljs-keyword">of</span> textAnnotation2.entityAnnotations
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Select an entity annotation in the first text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation2 = textAnnotation2.entityAnnotations[<span class="hljs-string">'urn:enhancement-26a923a4-fbb8-b39d-53ad-e2922474b7fc'</span>]
        expect(entityAnnotation2).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span>
        expect(entityAnnotation2.entity).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Select another entity in the same text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation2.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Check that the number of inputs matches.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">16</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fieldName2 = <span class="hljs-string">"wl_entities\\[<span class="hljs-subst">#{entityAnnotation2.entity.id}</span>\\]"</span>

        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[uri\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.id
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[label\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.label
        expect(element.find(<span class="hljs-string">"textarea[name='<span class="hljs-subst">#{fieldName2}</span>\\[description\\]']"</span>)[<span class="hljs-number">0</span>].innerHTML).toEqual entityAnnotation2.entity.description
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[type\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.type
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.thumbnails[<span class="hljs-number">0</span>]

    )</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Test for the entity to empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it <span class="hljs-string">'creates input boxes and textareas with entity data (non-merged)'</span>, inject<span class="hljs-function"><span class="hljs-params">((AnalysisService, $compile, $httpBackend, $rootScope) -&gt;

</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Compile the directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $compile(element)(scope)
      scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Get the mock-up analysis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.ajax(<span class="hljs-string">'base/app/assets/english.json'</span>,
        <span class="hljs-attribute">async</span>: <span class="hljs-literal">false</span>
      ).done <span class="hljs-function"><span class="hljs-params">(data)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Catch all the requests to Freebase.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $httpBackend.<span class="hljs-keyword">when</span>(<span class="hljs-string">'HEAD'</span>, <span class="hljs-regexp">/.*/</span>).respond(<span class="hljs-number">200</span>, <span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Simulate event broadcasted by AnalysisService</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'analysisReceived'</span>, AnalysisService.parse data</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Check that the analysis is set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(scope.analysis).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span>
        expect(scope.analysis.textAnnotations).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">0</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Select a text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotation1 = scope.analysis.textAnnotations[<span class="hljs-string">'urn:enhancement-1a452dcd-b97f-6d9c-8de5-b4cec57ec020'</span>]
        expect(textAnnotation1).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Select an entity annotation in the first text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1 = textAnnotation1.entityAnnotations[<span class="hljs-string">'urn:enhancement-ec266952-de23-ef06-896f-02f9434e99b0'</span>]
        expect(entityAnnotation1).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Select one entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fieldName1 = <span class="hljs-string">"wl_entities\\[<span class="hljs-subst">#{entityAnnotation1.entity.id}</span>\\]"</span>
        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">9</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">1</span>

        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[uri\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.id
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[label\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.label
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[type\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.type
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation1.entity.thumbnails[<span class="hljs-number">0</span>]
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">1</span>].value).toEqual entityAnnotation1.entity.thumbnails[<span class="hljs-number">1</span>]
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">2</span>].value).toEqual entityAnnotation1.entity.thumbnails[<span class="hljs-number">2</span>]
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName1}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">3</span>].value).toEqual entityAnnotation1.entity.thumbnails[<span class="hljs-number">3</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Get the decoded description and check it against the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        description = $(element.find(<span class="hljs-string">"textarea[name='<span class="hljs-subst">#{fieldName1}</span>\\[description\\]']"</span>)[<span class="hljs-number">0</span>]).text()
        expect(description).toEqual entityAnnotation1.entity.description</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Deselect the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">false</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Check that no inputs are selected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">0</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Reselect the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation1.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Select a text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotation2 = scope.analysis.textAnnotations[<span class="hljs-string">'urn:enhancement-233fd158-870d-6ca4-b7ce-30313e4a7015'</span>]
        expect(textAnnotation2).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Select an entity annotation in the first text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation2 = textAnnotation2.entityAnnotations[<span class="hljs-string">'urn:enhancement-26a923a4-fbb8-b39d-53ad-e2922474b7fc'</span>]
        expect(entityAnnotation2).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Select another entity in the same text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation2.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Check that the number of inputs matches.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">15</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fieldName2 = <span class="hljs-string">"wl_entities\\[<span class="hljs-subst">#{entityAnnotation2.entity.id}</span>\\]"</span>

        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[uri\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.id
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[label\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.label
        expect(element.find(<span class="hljs-string">"textarea[name='<span class="hljs-subst">#{fieldName2}</span>\\[description\\]']"</span>)[<span class="hljs-number">0</span>].innerHTML).toEqual entityAnnotation2.entity.description
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[type\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.type
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName2}</span>\\[image\\]\\[\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation2.entity.thumbnails[<span class="hljs-number">0</span>]

    )</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Test for the entity to empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it <span class="hljs-string">'creates input boxes and textareas with entity data (merged) with many sameAs'</span>, inject<span class="hljs-function"><span class="hljs-params">((AnalysisService, $compile, $httpBackend, $rootScope) -&gt;

</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Compile the directive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $compile(element)(scope)
      scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Get the mock-up analysis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.ajax(<span class="hljs-string">'base/app/assets/english.002.json'</span>,
        <span class="hljs-attribute">async</span>: <span class="hljs-literal">false</span>
      ).done <span class="hljs-function"><span class="hljs-params">(data)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Catch all the requests to Freebase.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $httpBackend.<span class="hljs-keyword">when</span>(<span class="hljs-string">'HEAD'</span>, <span class="hljs-regexp">/.*/</span>).respond(<span class="hljs-number">200</span>, <span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Simulate event broadcasted by AnalysisService</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $rootScope.$broadcast <span class="hljs-string">'analysisReceived'</span>, AnalysisService.parse data, <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Check that the analysis is set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(scope.analysis).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span>
        expect(scope.analysis.textAnnotations).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">0</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Get a Text Annotation and three entities that related to that Text Annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotationId = <span class="hljs-string">'urn:enhancement-a6bb446e-6e95-d6be-e91c-32833aa58b32'</span>
        entityAnnotationId = <span class="hljs-string">'urn:enhancement-663e0cfd-c482-f695-674e-cae98e42dd18'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Select a text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textAnnotation = scope.analysis.textAnnotations[textAnnotationId]
        expect(textAnnotation).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <pre><code>   dump <span class="hljs-string">"[ id :: <span class="hljs-subst">#{id}</span> ][ entity id :: <span class="hljs-subst">#{entityAnnotation.entity.id}</span> ]"</span> <span class="hljs-keyword">for</span> id, entityAnnotation <span class="hljs-keyword">of</span> textAnnotation.entityAnnotations
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Select an entity annotation in the first text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation = textAnnotation.entityAnnotations[entityAnnotationId]
        expect(entityAnnotation).<span class="hljs-keyword">not</span>.toBe <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Select one entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityAnnotation.selected = <span class="hljs-literal">true</span>
        scope.$digest()</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Check that there are no input boxes (no entities selected).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fieldName = <span class="hljs-string">"wl_entities\\[<span class="hljs-subst">#{entityAnnotation.entity.id}</span>\\]"</span>
        expect(element.find(<span class="hljs-string">'input'</span>).length).toEqual <span class="hljs-number">19</span>
        expect(element.find(<span class="hljs-string">'textarea'</span>).length).toEqual <span class="hljs-number">1</span>

        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName}</span>\\[uri\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation.entity.id
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName}</span>\\[label\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation.entity.label
        expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName}</span>\\[type\\]']"</span>)[<span class="hljs-number">0</span>].value).toEqual entityAnnotation.entity.type

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..entityAnnotation.entity.thumbnails.length]
          expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName}</span>\\[image\\]\\[\\]']"</span>)[i].value).toEqual entityAnnotation.entity.thumbnails[i]

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..entityAnnotation.entity.sameAs.length]
          expect(element.find(<span class="hljs-string">"input[name='<span class="hljs-subst">#{fieldName}</span>\\[sameas\\]\\[\\]']"</span>)[i].value).toEqual entityAnnotation.entity.sameAs[i]</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Get the decoded description and check it against the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        description = $(element.find(<span class="hljs-string">"textarea[name='<span class="hljs-subst">#{fieldName}</span>\\[description\\]']"</span>)[<span class="hljs-number">0</span>]).text()
        expect(description).toEqual entityAnnotation.entity.description

    )</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
