<!DOCTYPE html>

<html>
<head>
  <title>app.directives.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.coffee
              </a>
            
              
              <a class="source" href="app.config.html">
                app.config.coffee
              </a>
            
              
              <a class="source" href="app.constants.html">
                app.constants.coffee
              </a>
            
              
              <a class="source" href="app.controllers.html">
                app.controllers.coffee
              </a>
            
              
              <a class="source" href="app.directives.html">
                app.directives.coffee
              </a>
            
              
              <a class="source" href="app.directives.wlEntityProps.html">
                app.directives.wlEntityProps.coffee
              </a>
            
              
              <a class="source" href="app.services.AnalysisService.html">
                app.services.AnalysisService.coffee
              </a>
            
              
              <a class="source" href="app.services.EditorService.html">
                app.services.EditorService.coffee
              </a>
            
              
              <a class="source" href="app.services.EntityAnnotationService.html">
                app.services.EntityAnnotationService.coffee
              </a>
            
              
              <a class="source" href="app.services.EntityService.html">
                app.services.EntityService.coffee
              </a>
            
              
              <a class="source" href="app.services.Helpers.html">
                app.services.Helpers.coffee
              </a>
            
              
              <a class="source" href="app.services.TextAnnotationService.html">
                app.services.TextAnnotationService.coffee
              </a>
            
              
              <a class="source" href="app.services.html">
                app.services.coffee
              </a>
            
              
              <a class="source" href="traslator.html">
                traslator.coffee
              </a>
            
              
              <a class="source" href="chord.html">
                chord.coffee
              </a>
            
              
              <a class="source" href="timeline.html">
                timeline.coffee
              </a>
            
              
              <a class="source" href="EntitiesController.spec.html">
                EntitiesController.spec.coffee
              </a>
            
              
              <a class="source" href="addtl_properties.spec.html">
                addtl_properties.spec.coffee
              </a>
            
              
              <a class="source" href="controllers.error.spec.html">
                controllers.error.spec.coffee
              </a>
            
              
              <a class="source" href="directives.spec.html">
                directives.spec.coffee
              </a>
            
              
              <a class="source" href="services.spec.html">
                services.spec.coffee
              </a>
            
              
              <a class="source" href="tinymce.questa_volta_parliamo_di_seo.spec.html">
                tinymce.questa_volta_parliamo_di_seo.spec.coffee
              </a>
            
              
              <a class="source" href="tinymce.spec.html">
                tinymce.spec.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>app.directives.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>angular.<span class="hljs-built_in">module</span>(<span class="hljs-string">'wordlift.tinymce.plugin.directives'</span>, [<span class="hljs-string">'wordlift.directives.wlEntityProps'</span>,<span class="hljs-string">'wordlift.tinymce.plugin.controllers'</span>])</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The wlEntities directive provides a UI for disambiguating the entities for a provided text annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>.directive(<span class="hljs-string">'wlEntities'</span>,<span class="hljs-function"> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Restrict the directive to elements only (<wl-entities text-annotation="..."></wl-entities>)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">restrict</span>: <span class="hljs-string">'E'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Create a separate scope</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">scope</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Get the text annotation from the text-annotation attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-attribute">textAnnotation</span>: <span class="hljs-string">'='</span>
      <span class="hljs-attribute">onSelect</span>: <span class="hljs-string">'&amp;'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Create the link function in order to bind to children elements events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">link</span>: <span class="hljs-function"><span class="hljs-params">(scope, element, attrs)</span> -&gt;</span>

      scope.<span class="hljs-function"><span class="hljs-title">select</span> = <span class="hljs-params">(item)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Set the selected flag on each annotation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> id, entityAnnotation <span class="hljs-keyword">of</span> scope.textAnnotation.entityAnnotations</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>The selected flag is set to false for each annotation which is not the selected one.
For the selected one is set to true only if the entity is not selected already, otherwise it is deselected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          entityAnnotation.selected = item.id <span class="hljs-keyword">is</span> entityAnnotation.id &amp;&amp; !entityAnnotation.selected</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Call the select function with the textAnnotation and the selected entityAnnotation or null.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        scope.onSelect
          <span class="hljs-attribute">textAnnotation</span>: scope.textAnnotation
          <span class="hljs-attribute">entityAnnotation</span>: <span class="hljs-keyword">if</span> item.selected <span class="hljs-keyword">then</span> item <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>

    <span class="hljs-attribute">template</span>: <span class="hljs-string">"""
      &lt;div&gt;
        &lt;ul&gt;
          &lt;li ng-repeat="entityAnnotation in textAnnotation.entityAnnotations | orderObjectBy:'confidence':true"&gt;
            &lt;wl-entity on-select="select(entityAnnotation)" entity-annotation="entityAnnotation"&gt;&lt;/wl-entity&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
    """</span>
  )</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>The wlEntity directive shows a tile for a provided entityAnnotation. 
When a tile is clicked the function provided in the select attribute is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>.directive<span class="hljs-function"><span class="hljs-params">(<span class="hljs-string">'wlEntity'</span>, [<span class="hljs-string">'$log'</span>,<span class="hljs-string">'$compile'</span>, ($log, $compile)-&gt;
    restrict: <span class="hljs-string">'E'</span>
    scope:
      entityAnnotation: <span class="hljs-string">'='</span>
      onSelect: <span class="hljs-string">'&amp;'</span>
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Create the link function in order to bind to children elements events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">link</span>: <span class="hljs-function"><span class="hljs-params">(scope, element, attrs)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Holds a reference to the current entity </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scope.entity = scope.entityAnnotation?.entity

      template = <span class="hljs-string">"""
        &lt;div class="entity {{entityAnnotation.entity.css}}" ng-class="{selected: true==entityAnnotation.selected}" ng-click="onSelect()" ng-show="entity.label"&gt;
          &lt;div class="thumbnail" ng-show="entity.thumbnail" title="{{entity.id}}" ng-attr-style="background-image: url({{entity.thumbnail}})"&gt;&lt;/div&gt;
          &lt;div class="thumbnail empty" ng-hide="entity.thumbnail" title="{{entity.id}}"&gt;&lt;/div&gt;
          &lt;div class="confidence" ng-bind="entityAnnotation.confidence"&gt;&lt;/div&gt;
          &lt;div class="label" ng-bind="entity.label"&gt;&lt;/div&gt;
          &lt;div class="<span class="hljs-subst">#{scope.entity?.css}</span>-info url" entity="entity"&gt;&lt;/div&gt;
          &lt;div class="type"&gt;&lt;/div&gt;
          &lt;div class="source" ng-class="entity.source" ng-bind="entity.source"&gt;&lt;/div&gt;
        &lt;/div&gt;
      """</span>

      element.html(template).show();
      $compile(element.contents())(scope);

  ])
.directive<span class="hljs-function"><span class="hljs-params">(<span class="hljs-string">'wlEventInfo'</span>, [<span class="hljs-string">'$interpolate'</span>, ($interpolate)-&gt;
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Restrict the usage to the class attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">restrict</span>: <span class="hljs-string">'C'</span>
    <span class="hljs-attribute">scope</span>:
      <span class="hljs-attribute">entity</span>: <span class="hljs-string">'='</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Create the link function in order to bind to children elements events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">link</span>: <span class="hljs-function"><span class="hljs-params">(scope, element, attrs)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>TODO …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scope.startDate = scope.entity?.props[<span class="hljs-string">'http://www.w3.org/2002/12/cal#dtstart'</span>]?[<span class="hljs-number">0</span>]
      scope.endDate = scope.entity?.props[<span class="hljs-string">'http://www.w3.org/2002/12/cal#dtend'</span>]?[<span class="hljs-number">0</span>]
      scope.place = scope.entity?.props[<span class="hljs-string">'http://www.w3.org/2006/vcard/ns#locality'</span>]
      
      scope.<span class="hljs-function"><span class="hljs-title">renderDate</span> = <span class="hljs-params">()</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <pre><code>   <span class="hljs-built_in">console</span>.log scope.startDate
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> scope.startDate <span class="hljs-keyword">if</span> scope.startDate <span class="hljs-keyword">is</span> scope.endDate
        <span class="hljs-keyword">return</span> $interpolate(<span class="hljs-string">'{{startDate}} - {{endDate}}'</span>,<span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>)(scope)

    <span class="hljs-attribute">template</span>: <span class="hljs-string">"""
      &lt;span class="place" ng-bind="place"&gt;&lt;/span&gt; &lt;span class="date" ng-bind="renderDate()" title="{{renderDate()}}"&gt;&lt;/span&gt;
    """</span>
  ])</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>The wlEntityInputBoxes prints the inputs and textareas with entities data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>.directive(<span class="hljs-string">'wlEntityInputBoxes'</span>,<span class="hljs-function"> -&gt;</span>
    <span class="hljs-attribute">restrict</span>: <span class="hljs-string">'E'</span>
    <span class="hljs-attribute">scope</span>:
      <span class="hljs-attribute">textAnnotations</span>: <span class="hljs-string">'='</span>
    <span class="hljs-attribute">template</span>: <span class="hljs-string">"""
      &lt;div class="wl-entity-input-boxes" ng-repeat="textAnnotation in textAnnotations"&gt;
        &lt;div ng-repeat="entityAnnotation in textAnnotation.entityAnnotations | filterObjectBy:'selected':true"&gt;

          &lt;input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][uri]' value='{{entityAnnotation.entity.id}}'&gt;
          &lt;input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][label]' value='{{entityAnnotation.entity.label}}'&gt;
          &lt;textarea name='wl_entities[{{entityAnnotation.entity.id}}][description]'&gt;{{entityAnnotation.entity.description}}&lt;/textarea&gt;

          &lt;input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][main_type]' value='{{entityAnnotation.entity.type}}'&gt;

          &lt;input ng-repeat="type in entityAnnotation.entity.types" type='text'
          	name='wl_entities[{{entityAnnotation.entity.id}}][type][]' value='{{type}}'&gt;

          &lt;input ng-repeat="image in entityAnnotation.entity.thumbnails" type='text'
            name='wl_entities[{{entityAnnotation.entity.id}}][image][]' value='{{image}}'&gt;
          &lt;input ng-repeat="sameAs in entityAnnotation.entity.sameAs" type='text'
            name='wl_entities[{{entityAnnotation.entity.id}}][sameas][]' value='{{sameAs}}'&gt;

          &lt;input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][latitude]' value='{{entityAnnotation.entity.latitude}}'&gt;
          &lt;input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][longitude]' value='{{entityAnnotation.entity.longitude}}'&gt;

        &lt;/div&gt;
      &lt;/div&gt;
    """</span>
  )
.directive<span class="hljs-function"><span class="hljs-params">(<span class="hljs-string">'autocomplete'</span>, [<span class="hljs-string">'$compile'</span>, <span class="hljs-string">'$q'</span>, <span class="hljs-string">'$log'</span>, ($compile, $q, $log) -&gt;
    restrict: <span class="hljs-string">"A"</span>,
    scope:
      source: <span class="hljs-string">'&amp;'</span>
      onSelect: <span class="hljs-string">'&amp;'</span>
    link: (originalScope, elem, attrs, ctrl) -&gt;
      templateHtml = <span class="hljs-string">'&lt;wl-entity on-select="select(entityAnnotation)" entity-annotation="entityAnnotation"&gt;&lt;/wl-entity&gt;'</span>

      elem.autocomplete
        source: (request, response) -&gt;
          locals = { $viewValue: request.term }
          $q.<span class="hljs-keyword">when</span>(originalScope.source(locals)).<span class="hljs-keyword">then</span> (matches) -&gt;
            response matches
        minLength: <span class="hljs-number">3</span>
        open: () -&gt;
          originalScope.$emit(<span class="hljs-string">'autocompleteOpened'</span>)
        close: () -&gt;
          originalScope.$emit(<span class="hljs-string">'autocompleteClosed'</span>)
      
      .data(<span class="hljs-string">"ui-autocomplete"</span>)._renderItem = (ul, ea) -&gt;
        
        scope = originalScope.$<span class="hljs-keyword">new</span>();
        scope.entityAnnotation = ea
        
        scope.select = (entityAnnotation) -&gt;
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Set the higher priority for this item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          entityAnnotation.confidence = <span class="hljs-number">1.0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Reset autocomplete field &amp; hide results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          angular.element(elem).val(<span class="hljs-string">''</span>)
          angular.element(ul).hide()
          originalScope.$emit(<span class="hljs-string">'autocompleteClosed'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Call the onSelect callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          originalScope.onSelect
            <span class="hljs-attribute">entityAnnotation</span>: entityAnnotation
         
        originalScope.$<span class="hljs-literal">on</span> <span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>
          scope.$destroy();
        el = angular.element(templateHtml)
        compiled = $compile(el)

        $(<span class="hljs-string">"&lt;li&gt;"</span>).append(el).appendTo(ul)
        compiled(scope)
      
  ])</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
