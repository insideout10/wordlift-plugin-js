(function(){var a,b,c;angular.module("wordlift.ui.carousel",[]).directive("wlCarousel",["$window","$log",function(a,b){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel" ng-show="panes.length > 0">\n  <div class="wl-panes" style="width:{{panesWidth}}px; left:{{position}}px;" ng-transclude ng-swipe-right="next()"></div>\n  <div class="wl-carousel-arrow wl-prev" ng-click="prev()" ng-show="currentPaneIndex > 0">\n    <i class="wl-angle-left" />\n  </div>\n  <div class="wl-carousel-arrow wl-next" ng-click="next()" ng-hide="(currentPaneIndex + visibleElements()) == panes.length">\n    <i class="wl-angle-right" />\n  </div>\n</div>  ',controller:function(c,d){var e,f;return f=angular.element(a),c.visibleElements=function(){return d.width()>460?3:d.width()>1024?5:1},c.itemWidth=d.width()/c.visibleElements(),c.panesWidth=void 0,c.panes=[],c.position=0,c.currentPaneIndex=0,c.next=function(){return c.position=c.position-c.itemWidth,c.currentPaneIndex=c.currentPaneIndex+1},c.prev=function(){return c.position=c.position+c.itemWidth,c.currentPaneIndex=c.currentPaneIndex-1},c.setPanesWrapperWidth=function(){return b.debug("panes count "+c.panes.length),c.panesWidth=c.panes.length*c.itemWidth,c.position=0,c.currentPaneIndex=0},f.bind("resize",function(){var a,b,e,f;for(c.itemWidth=d.width()/c.visibleElements(),c.setPanesWrapperWidth(),f=c.panes,b=0,e=f.length;e>b;b++)a=f[b],a.scope.setWidth(c.itemWidth);return c.$apply()}),e=this,e.registerPane=function(a,b){var d;return a.setWidth(c.itemWidth),d={scope:a,element:b},c.panes.push(d),c.setPanesWrapperWidth()},e.unregisterPane=function(a){var b,d,e,f,g,h;for(e=void 0,h=c.panes,b=f=0,g=h.length;g>f;b=++f)d=h[b],d.scope.$id===a.$id&&(e=b);return c.panes.splice(e,1),c.setPanesWrapperWidth()}}}}]).directive("wlCarouselPane",["$log",function(a){return{require:"^wlCarousel",restrict:"EA",transclude:!0,template:"<div ng-transclude></div>",link:function(b,c,d,e){return a.debug("Going to add carousel pane with id "+b.$id+" to carousel"),c.addClass("wl-carousel-item"),b.setWidth=function(a){return c.css("width",""+a+"px")},b.$on("$destroy",function(){return a.debug("Destroy "+b.$id),e.unregisterPane(b)}),e.registerPane(b,c)}}}]),a=jQuery,angular.module("wordlift.facetedsearch.widget",["wordlift.ui.carousel"]).provider("configuration",function(){var a,b;return b=void 0,a={setConfiguration:function(a){return b=a},$get:function(){return b}}}).filter("filterEntitiesByType",["$log","configuration",function(a,b){return function(a,c){var d,e,f;e=[];for(f in a)d=a[f],d.mainType===c&&d.id!==b.entity_uri&&e.push(d);return e}}]).controller("FacetedSearchWidgetController",["DataRetrieverService","configuration","$scope","$log",function(a,b,c,d){return c.entity=void 0,c.posts=[],c.facets=[],c.conditions={},c.supportedTypes=["thing","person","organization","place","event"],c.isInConditions=function(a){return c.conditions[a.id]?!0:!1},c.addCondition=function(b){return d.debug("Add entity "+b.id+" to conditions array"),c.conditions[b.id]?delete c.conditions[b.id]:c.conditions[b.id]=b,a.load("posts",Object.keys(c.conditions))},c.$on("postsLoaded",function(a,e){return d.debug("Referencing posts for entity "+b.entity_id+" ..."),d.debug(e),c.posts=e,d.debug(c.posts)}),c.$on("facetsLoaded",function(a,e){var f,g,h;for(d.debug("Referencing facets for entity "+b.entity_id+" ..."),g=0,h=e.length;h>g;g++)f=e[g],f.id===b.entity_uri&&(c.entity=f);return c.facets=e})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(a,b,c,d){var e;return e={},e.load=function(e,f){var g;return null==f&&(f=[]),g=""+a.ajax_url+"?action="+a.action+"&entity_id="+a.entity_id+"&type="+e,b.debug("Going to search "+e+" with conditions"),b.debug(f),c({method:"post",url:g,data:f}).success(function(a){return d.$broadcast(""+e+"Loaded",a)}).error(function(a,c){return b.warn("Error loading "+e+", statut "+c)})},e}]).config(function(a){return a.setConfiguration(window.wl_faceted_search_params)}),a(b=a('	<div ng-controller="FacetedSearchWidgetController">\n    <h5>Contenuti associati a <strong>{{entity.label}}</strong></h5>\n    <div class="wl-facets" wl-carousel>\n      <div class="wl-facets-container" ng-repeat="type in supportedTypes" wl-carousel-pane>\n        <h6 ng-class="\'wl-fs-\' + type"><i class="type" />{{type}}</h6>\n        <ul>\n          <li class="entity" ng-repeat="entity in facets | filterEntitiesByType:type" ng-click="addCondition(entity)">     \n              <span class="wl-label" ng-class=" { \'selected\' : isInConditions(entity) }">{{entity.label}}</span>\n              <span class="counter">({{entity.counter}})</span>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class="wl-posts">\n      <div class="wl-conditions">\n        <span>Filtri:</span>\n        <strong class="wl-condition" ng-repeat="(condition, entity) in conditions">{{entity.label}}. </strong>\n      </div>\n      <div wl-carousel>\n        <div class="wl-post wl-card" ng-repeat="post in posts" wl-carousel-pane>\n          <img ng-src="{{post.thumbnail}}" />\n          <div class="wl-card-title"> \n            <a ng-href="/?p={{post.ID}}">{{post.post_title}}</a>\n          </div>\n        </div>\n      </div>\n\n    </div>\n   \n  </div>').appendTo("#wordlift-faceted-entity-search-widget"),c=angular.bootstrap(a("#wordlift-faceted-entity-search-widget"),["wordlift.facetedsearch.widget"])),c.invoke(["DataRetrieverService","$rootScope","$log",function(a,b){return b.$apply(function(){return a.load("posts"),a.load("facets")})}])}).call(this);
//# sourceMappingURL=wordlift-faceted-entity-search-widget.min.map