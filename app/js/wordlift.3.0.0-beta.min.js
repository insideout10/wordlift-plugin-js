(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};B=function(){function a(a){this._html=a}return a.prototype._htmlPositions=[],a.prototype._textPositions=[],a.prototype._html="",a.prototype._text="",a.create=function(b){var c;return c=new a(b),c.parse(),c},a.prototype.parse=function(){var a,b,c,d,e,f,g,h,i;for(this._htmlPositions=[],this._textPositions=[],this._text="",this._html=this._html.replace(/&nbsp;/gim," "),f=/([^<]*)(<[^>]*>)([^<]*)/gim,g=0,b=0;e=f.exec(this._html);)d=e[1],a=e[2],c=e[3],i=d+("</p>"===a.toLowerCase()?"\n\n":""),h=c,g+=i.length,b+=d.length+a.length,0<c.length&&(this._htmlPositions.push(b),this._textPositions.push(g)),g+=h.length,b+=c.length,this._text+=i+h;return""===this._text&&""!==this._html&&(this._text=new String(this._html)),0===this._textPositions.length||0!==this._textPositions[0]?(this._htmlPositions.unshift(0),this._textPositions.unshift(0)):void 0},a.prototype.text2html=function(a){var b,c,d,e,f;for(b=0,d=0,c=e=0,f=this._textPositions.length;(f>=0?f>e:e>f)&&!(a<this._textPositions[c]);c=f>=0?++e:--e)b=this._htmlPositions[c],d=this._textPositions[c];return b+a-d},a.prototype.html2text=function(a){var b,c,d,e,f;if(a<this._htmlPositions[0])return 0;for(b=0,d=0,c=e=0,f=this._htmlPositions.length;(f>=0?f>e:e>f)&&!(a<this._htmlPositions[c]);c=f>=0?++e:--e)b=this._htmlPositions[c],d=this._textPositions[c];return d+a-b},a.prototype.insertHtml=function(a,b){var c;return c=this.text2html(b.text),this._html=this._html.substring(0,c)+a+this._html.substring(c),this.parse()},a.prototype.getHtml=function(){return this._html},a.prototype.getText=function(){return this._text},a}(),window.Traslator=B,e="@context",s="@graph",C="@value",b="analysisReceived",u="http://www.w3.org/2000/01/rdf-schema#",w=""+u+"label",v=""+u+"comment",o="freebase",p="http://rdf."+o+".com/",q=""+p+"ns/",r=""+q+"common.topic.description",y="http://schema.org/",z=""+y+"description",k="http://fise.iks-project.eu/ontology/",m=""+k+"EntityAnnotation",n=""+k+"TextAnnotation",l=""+k+"confidence",i="http://purl.org/dc/terms/",f="dbpedia",g="http://"+f+".org/",h="http://(\\w{2}\\.)?"+f+".org/",D="http://www.w3.org/2003/01/geo/wgs84_pos#",j="content",A="textannotation",d="#content_ifr",x="running",t=".mce_wordlift, .mce-wordlift button",c="contenteditable",angular.module("wordlift.tinymce.plugin.config",[]),angular.module("wordlift.directives.wlEntityProps",[]).directive("wlEntityProps",function(){return{restrict:"E",scope:{textAnnotations:"="},template:'<div class="wl-entity-props" ng-repeat="textAnnotation in textAnnotations">\n  <div ng-repeat="ea in textAnnotation.entityAnnotations | filterObjectBy:\'selected\':true">\n    <div ng-repeat="(k, ps) in ea.entity.props">\n      <input ng-repeat="p in ps" name="wl_props[{{ea.entity.id}}][{{k}}][]" ng-value="p" type="text" />\n    </div>\n  </div>\n</div>'}}),angular.module("wordlift.tinymce.plugin.directives",["wordlift.directives.wlEntityProps","wordlift.tinymce.plugin.controllers"]).directive("wlEntities",function(){return{restrict:"E",scope:{textAnnotation:"=",onSelect:"&"},link:function(a){return a.select=function(b){var c,d,e;e=a.textAnnotation.entityAnnotations;for(d in e)c=e[d],c.selected=b.id===c.id&&!c.selected;return a.onSelect({textAnnotation:a.textAnnotation,entityAnnotation:b.selected?b:null})}},template:'<div>\n  <ul>\n    <li ng-repeat="entityAnnotation in textAnnotation.entityAnnotations | orderObjectBy:\'confidence\':true">\n      <wl-entity on-select="select(entityAnnotation)" entity-annotation="entityAnnotation"></wl-entity>\n    </li>\n  </ul>\n</div>'}}).directive("wlEntity",function(){return{restrict:"E",scope:{entityAnnotation:"=",onSelect:"&"},template:'<div class="entity {{entityAnnotation.entity.css}}" ng-class="{selected: true==entityAnnotation.selected}" ng-click="onSelect()" ng-show="entityAnnotation.entity.label">\n  <div class="thumbnail" ng-show="entityAnnotation.entity.thumbnail" title="{{entityAnnotation.entity.id}}" ng-attr-style="background-image: url({{entityAnnotation.entity.thumbnail}})"></div>\n  <div class="thumbnail empty" ng-hide="entityAnnotation.entity.thumbnail" title="{{entityAnnotation.entity.id}}"></div>\n  <div class="confidence" ng-bind="entityAnnotation.confidence"></div>\n  <div class="label" ng-bind="entityAnnotation.entity.label"></div>\n  <div class="url" ng-bind="entityAnnotation.entity.id"></div>\n  <div class="type"></div>\n  <div class="source" ng-class="entityAnnotation.entity.source" ng-bind="entityAnnotation.entity.source"></div>\n</div>'}}).directive("wlEntityInputBoxes",function(){return{restrict:"E",scope:{textAnnotations:"="},template:"<div class=\"wl-entity-input-boxes\" ng-repeat=\"textAnnotation in textAnnotations\">\n  <div ng-repeat=\"entityAnnotation in textAnnotation.entityAnnotations | filterObjectBy:'selected':true\">\n\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][uri]' value='{{entityAnnotation.entity.id}}'>\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][label]' value='{{entityAnnotation.entity.label}}'>\n    <textarea name='wl_entities[{{entityAnnotation.entity.id}}][description]'>{{entityAnnotation.entity.description}}</textarea>\n\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][main_type]' value='{{entityAnnotation.entity.type}}'>\n\n    <input ng-repeat=\"type in entityAnnotation.entity.types\" type='text'\n    	name='wl_entities[{{entityAnnotation.entity.id}}][type][]' value='{{type}}'>\n\n    <input ng-repeat=\"image in entityAnnotation.entity.thumbnails\" type='text'\n      name='wl_entities[{{entityAnnotation.entity.id}}][image][]' value='{{image}}'>\n    <input ng-repeat=\"sameAs in entityAnnotation.entity.sameAs\" type='text'\n      name='wl_entities[{{entityAnnotation.entity.id}}][sameas][]' value='{{sameAs}}'>\n\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][latitude]' value='{{entityAnnotation.entity.latitude}}'>\n    <input type='text' name='wl_entities[{{entityAnnotation.entity.id}}][longitude]' value='{{entityAnnotation.entity.longitude}}'>\n\n  </div>\n</div>"}}).directive("autocomplete",["$compile","$q","$log",function(b,c){return{restrict:"A",scope:{source:"&",onSelect:"&"},link:function(d,e){var f;return f='<wl-entity on-select="select(entityAnnotation)" entity-annotation="entityAnnotation"></wl-entity>',e.autocomplete({source:function(a,b){var e;return e={$viewValue:a.term},c.when(d.source(e)).then(function(a){return b(a)})},minLength:3}).data("ui-autocomplete")._renderItem=function(c,e){var g,h,i;return i=d.$new(),i.entityAnnotation=e,i.select=d.onSelect,d.$on("$destroy",function(){return i.$destroy()}),h=angular.element(f),g=b(h),a("<li>").append(h).appendTo(c),g(i)}}}}]),angular.module("AnalysisService",["wordlift.tinymce.plugin.services.EntityService","wordlift.tinymce.plugin.services.Helpers"]).service("AnalysisService",["EntityAnnotationService","EntityService","Helpers","TextAnnotationService","$filter","$http","$q","$rootScope","$log",function(a,c,d,f,g,h,j,k,o){var p;return p={_knownTypes:[],_entities:{},promise:void 0,isRunning:!1},p.addEntity=function(a){return this._entities[a.id]=a},p.setEntities=function(a){return this._entities=a},p.setKnownTypes=function(a){return this._knownTypes=a},p.abort=function(){return this.isRunning&&null!=this.promise?this.promise.resolve():void 0},p.preselect=function(b,d){var e,g,h,i,j,k,l,m;for(m=[],k=0,l=d.length;l>k;k++)if(e=d[k],j=f.findOrCreate(b.textAnnotations,e),i=a.find(j.entityAnnotations,{uri:e.uri}),0<i.length)m.push(i[0].selected=!0);else{if(h=c.find(b.entities,{uri:e.uri}),0===h.length){o.error("Missing entity in window.wordlift.entities collection!"),o.info(e);continue}b.entities[e.uri]=h[0],g=a.create({label:e.label,confidence:1,entity:b.entities[e.uri],relation:b.textAnnotations[j.id],selected:!0}),b.entityAnnotations[g.id]=g,m.push(j.entityAnnotations[g.id]=b.entityAnnotations[g.id])}return m},p.analyze=function(a,c){return null==c&&(c=!1),p.isRunning?void 0:(p.isRunning=!0,p.promise=j.defer(),h({method:"post",url:ajaxurl+"?action=wordlift_analyze",data:a,timeout:p.promise.promise}).success(function(a){return k.$broadcast(b,p.parse(a,c)),p.isRunning=!1}).error(function(a,c){return p.isRunning=!1,k.$broadcast(b,void 0),0!==c?k.$broadcast("error","An error occurred while requesting an analysis."):void 0}))},p.parse=function(b,g){var h,j,o,q,r,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;if(null==g&&(g=!1),B=[],E={},w={},t={},q=function(a){return{code:d.get(""+i+"language",a,o),confidence:d.get(l,a,o),_item:a}},null==b[e]||null==b[s])return k.$broadcast("error","The analysis response is invalid. Please try again later."),!1;for(o=b[e],x=b[s],G=0,I=x.length;I>G;G++)z=x[G],y=z["@id"],F=z["@type"],r=d.get(""+i+"type",z,o),d.containsOrEquals(n,F,o)&&d.containsOrEquals(""+i+"LinguisticSystem",r,o)?B.push(q(z)):d.containsOrEquals(n,F,o)?E[y]=z:d.containsOrEquals(m,F,o)?w[y]=z:t[y]=z;B.sort(function(a,b){return a.confidence<b.confidence?-1:a.confidence>b.confidence?1:0}),A=B[0].code;for(y in t)z=t[y],t[y]=c.create(z,A,p._knownTypes,o);if(g)for(y in t)u=t[y],c.merge(u,t);if(g){K=this._entities;for(y in K)u=K[y],c.merge(u,t)}for(y in E)z=E[y],E[y]=f.build(z,o);for(y in w)for(z=w[y],L=a.build(z,A,t,E,o),H=0,J=L.length;J>H;H++)v=L[H],w[v.id]=v;if(g)for(D in E){C=E[D],M=C.entityAnnotations;for(y in M){v=M[y],N=C.entityAnnotations;for(j in N)h=N[j],y!==j&&v.entity===h.entity&&delete C.entityAnnotations[j]}}return{language:A,entities:t,entityAnnotations:w,textAnnotations:E,languages:B}},p}]),angular.module("wordlift.tinymce.plugin.services.EditorService",["wordlift.tinymce.plugin.config","AnalysisService"]).service("EditorService",["AnalysisService","EntityAnnotationService","$rootScope","$log",function(e,f,g){var h,i,k;return h=function(){return tinyMCE.get(j)},i=function(a){var b,c,d,e;for(d=B.create(a),c=/<(\w+)[^>]*\sitemid="([^"]+)"[^>]*>([^<]+)<\/\1>/gim,e=[];b=c.exec(a);)e.push({start:d.html2text(b.index),end:d.html2text(b.index+b[0].length),uri:b[2],label:b[3]});return e},k={embedAnalysis:function(){return function(a){var b,c,d,g,j,k,l,m,n,o,p;for(b=h(),k=b.getContent({format:"raw"}),d=i(k),e.preselect(a,d);k.match(/<(\w+)[^>]*\sclass="textannotation[^"]*"[^>]*>([^<]+)<\/\1>/gim,"$2");)k=k.replace(/<(\w+)[^>]*\sclass="textannotation[^"]*"[^>]*>([^<]+)<\/\1>/gim,"$2");o=B.create(k),p=a.textAnnotations;for(n in p)m=p[n],0<Object.keys(m.entityAnnotations).length&&(c='<span id="'+n+'" class="'+A,j=f.find(m.entityAnnotations,{selected:!0}),0<j.length&&null!=j[0].entity&&(g=j[0].entity,c+=" highlight "+g.css+'" itemid="'+g.id),c+='">',o.insertHtml(c,{text:m.start}),o.insertHtml("</span>",{text:m.end}));return l=b.isDirty(),b.setContent(o.getHtml(),{format:"raw"}),b.isNotDirty=!l}}(this),analyze:function(b){return e.isRunning?e.abort():(a(t).addClass(x),h().getBody().setAttribute(c,!1),e.analyze(b,!0))},getWinPos:function(b){var c,e;return c=h(),e=b.target,{top:a(d).offset().top-a("body").scrollTop()+e.offsetTop-a(c.getBody()).scrollTop(),left:a(d).offset().left-a("body").scrollLeft()+e.offsetLeft-a(c.getBody()).scrollLeft()}}},g.$on("selectEntity",function(a,b){var c,d,f,g,i,j;return d=h().dom,g=b.ta.id,c=A,null!=b.ea?(f=b.ea.entity,c+=" highlight "+f.css,j="itemscope",i=f.id,e.addEntity(f)):(j=null,i=null),d.setAttrib(g,"class",c),d.setAttrib(g,"itemscope",j),d.setAttrib(g,"itemid",i)}),g.$on(b,function(b,d){return null!=d&&null!=d.textAnnotations&&k.embedAnalysis(d),a(t).removeClass(x),h().getBody().setAttribute(c,!0)}),k}]),angular.module("wordlift.tinymce.plugin.services.EntityAnnotationService",[]).service("EntityAnnotationService",["Helpers",function(a){var b;return b={},b.create=function(b){var c;return c={id:"uri:local-entity-annotation-"+a.uniqueId(32),label:"",confidence:0,entity:null,relation:null,selected:!1,_item:null},null!=b.entity&&null==b.entity.label&&(b.entity.label=b.label),a.merge(c,b)},b.build=function(c,d,e,f,g){var h,j,m,n,o,p,q,r;if(m=a.get(""+k+"entity-reference",c,g),null==e[m])return[];for(h=[],o=a.get(""+i+"relation",c,g),o=angular.isArray(o)?o:[o],q=0,r=o.length;r>q;q++)n=o[q],p=f[n],j=b.create({id:a.get("@id",c,g),label:a.getLanguage(""+k+"entity-label",c,d,g),confidence:a.get(l,c,g),entity:e[m],relation:p,_item:c}),null!=p&&(p.entityAnnotations[j.id]=j),h.push(j);return h},b.find=function(a,b){var c,d;return null!=b.uri?function(){var e,f;f=[];for(d in a)c=a[d],(b.uri===c.entity.id||(e=b.uri,G.call(c.entity.sameAs,e)>=0))&&f.push(c);return f}():null!=b.selected?function(){var e;e=[];for(d in a)c=a[d],c.selected===b.selected&&e.push(c);return e}():void 0},b}]),angular.module("wordlift.tinymce.plugin.services.EntityService",["wordlift.tinymce.plugin.services.Helpers"]).service("EntityService",["Helpers","$filter",function(a,b){var c;return c={},c.find=function(a,b){var c,d;return null!=b.uri?function(){var e,f;f=[];for(d in a)c=a[d],(b.uri===(null!=c?c.id:void 0)||(e=b.uri,G.call(null!=c?c.sameAs:void 0,e)>=0))&&f.push(c);return f}():void 0},c.create=function(b,d,e,g){var i,j,k,l,m,n,s,t;return l=a.get("@id",b,g),t=a.get("@type",b,g,function(b){var c,d,e,f;for(b=angular.isArray(b)?b:[b],f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push(a.expand(c,g));return f}),n=a.get("http://www.w3.org/2002/07/owl#sameAs",b,g),n=angular.isArray(n)?n:[n],k=function(a){var b,c,d,e,f;for(a=angular.isArray(a)?a:[a],f=[],d=0,e=a.length;e>d;d++)c=a[d],b=/m\.(.*)$/i.exec(c),f.push(null===b?c:"https://usercontent.googleapis.com/"+o+"/v1/image/m/"+b[1]+"?maxwidth=4096&maxheight=4096");return f},s=a.get(["http://xmlns.com/foaf/0.1/depiction",""+q+"common.topic.image",""+y+"image"],b,g,k),m=c.getKnownTypes(t,e,g),i=m[0].type.css,j={id:l,thumbnail:0<s.length?s[0]:null,thumbnails:s,css:i,type:m[0].type.uri,types:t,label:a.getLanguage(w,b,d,g),labels:a.get(w,b,g),sameAs:n,source:l.match("^"+p+".*$")?o:l.match("^"+h+".*$")?f:"wordlift",_item:b,props:c.createProps(b,g)},j.sources=[j.source],j.description=a.getLanguage([v,r,z],b,d,g),j.descriptions=a.get([v,r,z],b,g),null==j.description&&(j.description=""),j.latitude=a.get(""+D+"lat",b,g),j.longitude=a.get(""+D+"long",b,g),(0===j.latitude.length||0===j.longitude.length)&&(j.latitude="",j.longitude=""),j},c.merge=function(b,d){var e,g,h,i,j;for(j=b.sameAs,h=0,i=j.length;i>h;h++)g=j[h],null!=d[g]&&d[g]!==b&&(e=d[g],a.mergeUnique(b.sameAs,e.sameAs),a.mergeUnique(b.thumbnails,e.thumbnails),a.mergeUnique(b.sources,e.sources),null==b.css&&(b.css=e.css),b.source=b.sources.join(", "),f===e.source&&(b.description=e.description),f===e.source&&null!=e.longitude&&(b.longitude=e.longitude),f===e.source&&null!=e.latitude&&(b.latitude=e.latitude),d[g]=b,c.merge(b,d));return b},c.getKnownTypes=function(c,d,e){var f,g,h,i,j,k,l,m;for(i=[],f=void 0,l=0,m=d.length;m>l;l++)g=d[l],G.call(g.sameAs,"*")>=0&&(f=[{type:g}]),k=g.sameAs.concat(g.uri),h=function(){var b,d,f;for(f=[],b=0,d=k.length;d>b;b++)j=k[b],a.containsOrEquals(j,c,e)&&f.push(j);return f}(),0<h.length&&i.push({matches:h,type:g});return 0===i.length?f:(b("orderBy")(i,"matches",!0),i)},c.createProps=function(b,c){var d,e,f,g;f={};for(e in b)g=b[e],angular.isObject(g)||(d=a.expand(e,c),null==f[d]&&(f[d]=[]),f[d].push(a.expand(g,c)));return f},c}]),angular.module("wordlift.tinymce.plugin.services.Helpers",[]).service("Helpers",[function(){var a;return a={},a.merge=function(a,b){return this.extend(this.extend({},a),b)},a.extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},a.uniqueId=function(a){var b;for(null==a&&(a=8),b="";b.length<a;)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},a._expand=function(a,b){var c,d,e,f;if(null!=a)return null===(c=(""+a).match(/([\w|\d]+):(.*)/))?(e=a,d=""):(e=c[1],d=c[2]),null==b[e]?a:(f=angular.isString(b[e])?b[e]:b[e]["@id"],f+d)},a.expand=function(b,c){var d;return angular.isArray(b)?function(){var e,f,g;for(g=[],e=0,f=b.length;f>e;e++)d=b[e],g.push(a.expand(d,c));return g}():a._expand(b,c)},a.get=function(b,c,d,e){var f,g,h,i,j;if(!angular.isArray(b))return a.getA(b,c,d,e);for(h=[],i=0,j=b.length;j>i;i++)g=b[i],f=a.getA(g,c,d,e),f=angular.isArray(f)?f:[f],a.mergeUnique(h,f);return h},a.getA=function(b,c,d,e){var f,g,h;null==e&&(e=function(a){return a}),h=a.expand(b,d);for(f in c)if(g=c[f],h===a.expand(f,d))return e(g);return[]},a.getLanguage=function(b,c,d,e){var f,g,h,i,j,k;if(null!==(g=a.get(b,c,e))){for(g=angular.isArray(g)?g:[g],h=0,j=g.length;j>h;h++)if(f=g[h],d===f["@language"])return f[C];for(i=0,k=g.length;k>i;i++)if(f=g[i],"en"===f["@language"])return f[C]}},a.mergeUnique=function(a,b){var c,d,e,f;for(null==a&&(a=[]),f=[],d=0,e=b.length;e>d;d++)c=b[d],G.call(a,c)<0&&f.push(a.push(c));return f},a.containsOrEquals=function(b,c,d){var e,f,g,h,i;if(null==c)return!1;for(g=angular.isArray(c)?c:[c],f=a.expand(b,d),h=0,i=g.length;i>h;h++)if(e=g[h],f===a.expand(e,d))return!0;return!1},a}]),angular.module("wordlift.tinymce.plugin.services.TextAnnotationService",[]).service("TextAnnotationService",["Helpers",function(a){var b;return b={},b.create=function(b){var c;return null==b&&(b={}),c={id:"urn:local-text-annotation-"+a.uniqueId(32),text:"",start:0,end:0,confidence:0,entityAnnotations:{},_item:null},a.merge(c,b)},b.build=function(c,d){return b.create({id:a.get("@id",c,d),text:a.get(""+k+"selected-text",c,d)[C],start:a.get(""+k+"start",c,d),end:a.get(""+k+"end",c,d),confidence:a.get(l,c,d),entityAnnotations:{},_item:c})},b.find=function(a,b,c){var d,e;for(e in a)if(d=a[e],d.start===b&&d.end===c)return d},b.findOrCreate=function(a,c){var d;return d=b.find(a,c.start,c.end),null!=d?d:(d=b.create({text:c.label,start:c.start,end:c.end,confidence:1}),a[d.id]=d,d)},b}]),angular.module("wordlift.tinymce.plugin.services",["wordlift.tinymce.plugin.config","wordlift.tinymce.plugin.services.EditorService","wordlift.tinymce.plugin.services.EntityService","wordlift.tinymce.plugin.services.EntityAnnotationService","wordlift.tinymce.plugin.services.TextAnnotationService","wordlift.tinymce.plugin.services.Helpers","AnalysisService"]),angular.module("wordlift.tinymce.plugin.controllers",["wordlift.tinymce.plugin.config","wordlift.tinymce.plugin.services"]).filter("orderObjectBy",function(){return function(a,b,c){var d;return d=[],angular.forEach(a,function(a){return d.push(a)}),d.sort(function(a,c){return a[b]>c[b]}),c&&d.reverse(),d}}).filter("filterObjectBy",function(){return function(a,b,c){var d;return d=[],angular.forEach(a,function(a){return a[b]===c?d.push(a):void 0}),d}}).controller("EntitiesController",["EntityAnnotationService","EditorService","$http","$log","$scope",function(b,c,d,e,f){var g,h,i;return f.analysis=null,f.textAnnotation=null,f.textAnnotationSpan=null,i=function(b){return a("head").append("<style>#wordlift-disambiguation-popover .postbox:before,#wordlift-disambiguation-popover .postbox:after{top:"+b+"px;}</style>")},g=void 0,h=function(){var a;if(null!=g)return a=c.getWinPos(g),i(a.top-50)},a(window).scroll(h),a("#content_ifr").contents().scroll(h),f.search=function(a){return d({method:"post",url:ajaxurl+"?action=wordlift_search",data:a}).then(function(a){return a.data.map(function(a){return b.create({entity:a})})})},f.onEntitySearched=function(){return e.debug("Selected an entity on search")},f.onEntitySelected=function(a,b){return f.$emit("selectEntity",{ta:a,ea:b})},f.$on("analysisReceived",function(a,b){return f.analysis=b}),f.$on("textAnnotationClicked",function(b,d,e){var g,h;return f.textAnnotation=f.analysis.textAnnotations[d],null==(null!=(h=f.textAnnotation)?h.entityAnnotations:void 0)||0===Object.keys(f.textAnnotation.entityAnnotations).length?a("#wordlift-disambiguation-popover").hide():(g=c.getWinPos(e),i(g.top-50),a("#wordlift-disambiguation-popover").show())})}]).controller("ErrorController",["$element","$scope","$log",function(b,c){var d;return d=a(b).dialog({title:"WordLift",dialogClass:"wp-dialog",modal:!0,autoOpen:!1,closeOnEscape:!0,buttons:{Ok:function(){return a(this).dialog("close")}}}),c.$on("error",function(a,b){return c.message=b,d.dialog("open")})}]),a=jQuery,angular.module("wordlift.tinymce.plugin",["wordlift.tinymce.plugin.controllers","wordlift.tinymce.plugin.directives"]),a(E=a('<div id="wl-app" class="wl-app">\n  <div id="wl-error-controller" class="wl-error-controller" ng-controller="ErrorController">\n    <p ng-bind="message"></p>\n  </div>\n  <div id="wordlift-disambiguation-popover" class="metabox-holder" ng-controller="EntitiesController">\n    <div class="postbox">\n      <div class="handlediv" title="Click to toggle"><br></div>\n      <h3 class="hndle"><span>Semantic Web</span></h3>\n      <div class="inside">\n        <form role="form">\n          <div class="form-group">\n            <div class="ui-widget">\n              <input type="text" class="form-control" id="search" placeholder="search or create" autocomplete source="search($viewValue)" on-select="onEntitySearched(entityAnnotation)">\n            </div>\n          </div>\n          <wl-entities on-select="onEntitySelected(textAnnotation, entityAnnotation)" text-annotation="textAnnotation"></wl-entities>\n\n        </form>\n\n        <wl-entity-input-boxes text-annotations="analysis.textAnnotations"></wl-entity-input-boxes>\n        <wl-entity-props text-annotations="analysis.textAnnotations"></wl-entity-props>\n      </div>\n    </div>\n  </div>\n</div>').appendTo("form[name=post]"),a("#wordlift-disambiguation-popover").css({display:"none",height:a("body").height()-a("#wpadminbar").height()+12,top:a("#wpadminbar").height()-1,right:20}).draggable(),a("#wordlift-disambiguation-popover .handlediv").click(function(){return a("#wordlift-disambiguation-popover").hide()}),F=angular.bootstrap(a("#wl-app"),["wordlift.tinymce.plugin"]),F.invoke(["AnalysisService",function(a){return null!=window.wordlift?(a.setKnownTypes(window.wordlift.types),a.setEntities(window.wordlift.entities)):void 0}]),tinymce.PluginManager.add("wordlift",function(a){return a.addButton("wordlift",{classes:"widget btn wordlift",text:"",tooltip:"Click to analyze the content",onclick:function(){return F.invoke(["EditorService","$rootScope","$log",function(b,c){return c.$apply(function(){var c,d;return c=a.getContent({format:"raw"}),d=B.create(c).getText(),b.analyze(d)})}])}}),a.onClick.add(function(a,b){return F.invoke(["$rootScope",function(a){return a.$apply(function(){return a.$broadcast("textAnnotationClicked",b.target.id,b)})}])})}))}).call(this);
//# sourceMappingURL=wordlift.3.0.0-beta.min.map