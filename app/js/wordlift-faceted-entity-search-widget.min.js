(function(){var a,b,c;a=jQuery,angular.module("wordlift.facetedsearch.widget",[]).provider("configuration",function(){var a,b;return b=void 0,a={setConfiguration:function(a){return b=a},$get:function(){return b}}}).filter("filterEntitiesByType",["$log","configuration",function(a,b){return function(a,c){var d,e,f;e=[];for(f in a)d=a[f],d.mainType===c&&d.id!==b.entity_uri&&e.push(d);return e}}]).controller("FacetedSearchWidgetController",["DataRetrieverService","configuration","$scope","$log",function(a,b,c,d){return c.entity=void 0,c.posts=[],c.facets=[],c.conditions={},c.supportedTypes=["thing","person","organization","place","event"],c.isInConditions=function(a){return c.conditions[a.id]?!0:!1},c.addCondition=function(b){return d.debug("Add entity "+b.id+" to conditions array"),c.conditions[b.id]?delete c.conditions[b.id]:c.conditions[b.id]=b,a.load("posts",Object.keys(c.conditions))},c.$on("postsLoaded",function(a,e){return d.debug("Referencing posts for entity "+b.entity_id+" ..."),c.posts=e}),c.$on("facetsLoaded",function(a,e){var f,g,h;for(d.debug("Referencing facets for entity "+b.entity_id+" ..."),g=0,h=e.length;h>g;g++)f=e[g],f.id===b.entity_uri&&(c.entity=f);return c.facets=e})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(a,b,c,d){var e;return e={},e.load=function(e,f){var g;return null==f&&(f=[]),g=""+a.ajax_url+"?action="+a.action+"&entity_id="+a.entity_id+"&type="+e,b.debug("Going to search "+e+" with conditions"),b.debug(f),c({method:"post",url:g,data:f}).success(function(a){return d.$broadcast(""+e+"Loaded",a)}).error(function(a,c){return b.warn("Error loading "+e+", statut "+c)})},e}]).config(function(a){return a.setConfiguration(window.wl_faceted_search_params)}),a(b=a('<div ng-controller="FacetedSearchWidgetController">\n      <div class="facets">\n        <fieldset ng-repeat="type in supportedTypes">\n          <legend>{{type}}</legend>\n          <ul>\n            <li ng-class="\'wl-fs-\' + entity.mainType" class="entity" ng-repeat="entity in facets | filterEntitiesByType:type" ng-click="addCondition(entity)">\n              <i class="checkbox" ng-class=" { \'selected\' : isInConditions(entity) }" /><i class="type" /><span class="label">{{entity.label}}</span>\n            </li>\n          </ul>\n        </fieldset>\n      </div>\n      <div class="posts">\n        <div class="conditions">\n          Contenuti associati a <strong>{{entity.label}}</strong><br />\n          <span>Filtri:</span>\n          <strong class="condition" ng-repeat="(condition, entity) in conditions">{{entity.label}}. </strong>\n        </div>\n        <div class="post" ng-repeat="post in posts">\n          <a ng-href="{{post.guid}}">{{post.post_title}}</a>\n        </div>   \n      </div>\n      <br class="clear" />\n    </div>').appendTo("#wordlift-faceted-entity-search-widget"),c=angular.bootstrap(a("#wordlift-faceted-entity-search-widget"),["wordlift.facetedsearch.widget"])),c.invoke(["DataRetrieverService","$rootScope","$log",function(a,b){return b.$apply(function(){return a.load("posts"),a.load("facets")})}])}).call(this);
//# sourceMappingURL=wordlift-faceted-entity-search-widget.min.map