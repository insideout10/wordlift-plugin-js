(function(){var a,b,c,d,e=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b=function(){function a(a){this._html=a}return a.prototype._htmlPositions=[],a.prototype._textPositions=[],a.prototype._html="",a.prototype._text="",a.create=function(b){var c;return c=new a(b),c.parse(),c},a.prototype.parse=function(){var a,b,c,d,e,f,g,h,i;for(this._htmlPositions=[],this._textPositions=[],this._text="",this._html=this._html.replace(/&nbsp;/gim," "),f=/([^<]*)(<[^>]*>)([^<]*)/gim,g=0,b=0;e=f.exec(this._html);)d=e[1],a=e[2],c=e[3],i=d+("</p>"===a.toLowerCase()?"\n\n":""),h=c,g+=i.length,b+=d.length+a.length,this._htmlPositions.push(b),this._textPositions.push(g),g+=h.length,b+=c.length,this._text+=i+h;return""===this._text&&""!==this._html&&(this._text=new String(this._html)),0===this._textPositions.length||0!==this._textPositions[0]?(this._htmlPositions.unshift(0),this._textPositions.unshift(0)):void 0},a.prototype.text2html=function(a){var b,c,d,e,f;for(b=0,d=0,c=e=0,f=this._textPositions.length;(f>=0?f>e:e>f)&&!(a<this._textPositions[c]);c=f>=0?++e:--e)b=this._htmlPositions[c],d=this._textPositions[c];return b+a-d},a.prototype.html2text=function(a){var b,c,d,e,f;if(a<this._htmlPositions[0])return 0;for(b=0,d=0,c=e=0,f=this._htmlPositions.length;(f>=0?f>e:e>f)&&!(a<this._htmlPositions[c]);c=f>=0?++e:--e)b=this._htmlPositions[c],d=this._textPositions[c];return d+a-b},a.prototype.insertHtml=function(a,b){var c;return c=this.text2html(b.text),this._html=this._html.substring(0,c)+a+this._html.substring(c),this.parse()},a.prototype.getHtml=function(){return this._html},a.prototype.getText=function(){return this._text},a}(),window.Traslator=b,angular.module("wordlift.ui.carousel",[]).directive("wlCarousel",["$window","$log",function(a){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel">\n  <div class="wl-panes" style="width:{{panesWidth}}px; left:{{position}}px;" ng-transclude ng-swipe-right="next()"></div>\n  <div class="wl-carousel-arrow wl-next" ng-click="next()">\n    <i class="wl-angle-right" />\n  </div>\n  <div class="wl-carousel-arrow wl-prev" ng-click="prev()">\n    <i class="wl-angle-left" />\n  </div>\n</div>      ',controller:function(b,c){var d,e;return e=angular.element(a),b.visibleElements=function(){return c.width()>460?3:c.width()>1024?5:1},b.itemWidth=c.width()/b.visibleElements(),b.panesWidth=void 0,b.panes=[],b.position=0,b.next=function(){return b.position=b.position-b.itemWidth},b.prev=function(){return b.position=b.position+b.itemWidth},b.setPanesWrapperWidth=function(){return b.panesWidth=b.panes.length*b.itemWidth},e.bind("resize",function(){var a,d,e,f;for(b.itemWidth=c.width()/b.visibleElements(),b.setPanesWrapperWidth(),f=b.panes,d=0,e=f.length;e>d;d++)a=f[d],a.scope.setWidth(b.itemWidth);return b.$apply()}),d=this,d.registerPane=function(a,c){var d;return a.setWidth(b.itemWidth),d={scope:a,element:c},b.panes.push(d),b.setPanesWrapperWidth()},d.unregisterPane=function(a){var c,d,e,f,g,h;for(e=void 0,h=b.panes,c=f=0,g=h.length;g>f;c=++f)d=h[c],d.scope.$id===a.$id&&(e=c);return e&&b.panes.splice(e,1),b.setPanesWrapperWidth()}}}}]).directive("wlCarouselPane",["$log",function(a){return{require:"^wlCarousel",restrict:"EA",transclude:!0,template:"<div ng-transclude></div>",link:function(b,c,d,e){return a.debug("Going to add carousel pane with id "+b.$id+" to carousel"),c.addClass("wl-carousel-item"),b.setWidth=function(a){return c.css("width",""+a+"px")},b.$on("$destroy",function(){return e.unregisterPane(b)}),e.registerPane(b,c)}}}]),angular.module("wordlift.editpost.widget.controllers.EditPostWidgetController",["wordlift.editpost.widget.services.AnalysisService","wordlift.editpost.widget.services.EditorService","wordlift.editpost.widget.providers.ConfigurationProvider"]).filter("filterEntitiesByTypesAndRelevance",["$log",function(){return function(a,b){var c,d,f,g,h,i;if(f=[],null==a)return f;h=Math.floor(1/120*Object.keys(a).length+.75);for(g in a)if(d=a[g],i=d.mainType,e.call(b,i)>=0){if(c=Object.keys(d.annotations).length,c>h&&1===d.confidence){f.push(d);continue}if(d.occurrences.length>0){f.push(d);continue}d.id.match(/redlink/)&&f.push(d)}return f}}]).filter("filterEntitiesByTypes",["$log",function(){return function(a,b){var c,d,f,g;d=[];for(f in a)c=a[f],g=c.mainType,e.call(b,g)>=0&&d.push(c);return d}}]).filter("isEntitySelected",["$log",function(){return function(a){var b,c,d;c=[];for(d in a)b=a[d],b.occurrences.length>0&&c.push(b);return c}}]).controller("EditPostWidgetController",["EditorService","AnalysisService","configuration","$log","$scope","$rootScope","$injector",function(a,b,c,d,f){var g,h,i,j,k,l,m,n;for(f.analysis=void 0,f.newEntity=b.createEntity(),f.selectedEntities={},f.widgets={},f.annotation=void 0,f.boxes=[],f.images={},f.isSelectionCollapsed=!0,f.configuration=c,m=f.configuration.classificationBoxes,i=0,k=m.length;k>i;i++)for(g=m[i],f.selectedEntities[g.id]={},f.widgets[g.id]={},n=g.registeredWidgets,j=0,l=n.length;l>j;j++)h=n[j],f.widgets[g.id][h]=[];return f.createTextAnnotationFromCurrentSelection=function(){return a.createTextAnnotationFromCurrentSelection()},f.selectAnnotation=function(b){return a.selectAnnotation(b)},f.isEntitySelected=function(a,b){return null!=f.selectedEntities[b.id][a.id]},f.isLinkedToCurrentAnnotation=function(a){var b;return b=f.annotation,e.call(a.occurrences,b)>=0},f.addNewEntityToAnalysis=function(){var a;return f.newEntity.sameAs&&(f.newEntity.sameAs=[f.newEntity.sameAs]),delete f.newEntity.suggestedSameAs,d.debug(f.newEntity),f.analysis.entities[f.newEntity.id]=f.newEntity,a=f.analysis.annotations[f.annotation],a.entityMatches.push({entityId:f.newEntity.id,confidence:1}),f.analysis.entities[f.newEntity.id].annotations[a.id]=a,f.analysis.annotations[f.annotation].entities[f.newEntity.id]=f.newEntity,f.newEntity=b.createEntity()},f.$on("isSelectionCollapsed",function(a,b){return f.isSelectionCollapsed=b}),f.$on("updateOccurencesForEntity",function(a,b,c){var e,h,i;if(d.debug("Occurrences "+c.length+" for "+b),f.analysis.entities[b].occurrences=c,0===c.length){h=f.selectedEntities,i=[];for(g in h)e=h[g],i.push(delete f.selectedEntities[g][b]);return i}}),f.$on("textAnnotationClicked",function(a,b){return f.annotation=b}),f.$on("textAnnotationAdded",function(a,c){return d.debug("added a new annotation with Id "+c.id),f.analysis.annotations[c.id]=c,f.annotation=c.id,f.newEntity.label=c.text,b.getSuggestedSameAs(c.text)}),f.$on("sameAsRetrieved",function(a,b){return d.debug("Retrieved sameAs "+b),f.newEntity.suggestedSameAs=b}),f.$on("analysisPerformed",function(a,b){var c,e,h,i,j,k,l;for(f.analysis=b,k=f.configuration.classificationBoxes,l=[],i=0,j=k.length;j>i;i++)g=k[i],l.push(function(){var a,i,j,k;for(j=g.selectedEntities,k=[],a=0,i=j.length;i>a;a++)e=j[a],(c=b.entities[e])?(f.selectedEntities[g.id][e]=b.entities[e],k.push(function(){var a,b,d,e;for(d=c.images,e=[],b=0,a=d.length;a>b;b++)h=d[b],e.push(f.images[h]=c.label);return e}())):k.push(d.warn("Entity with id "+e+" should be linked to "+g.id+" but is missing"));return k}());return l}),f.onSelectedEntityTile=function(a,b){var c,e,h,i,j,k,l,m,n;d.debug("Entity tile selected for entity "+a.id+" within '"+b.id+"' scope"),l=f.boxes;for(c in l)g=l[c],g.closeWidgets();if(null==f.selectedEntities[b.id][a.id]){for(f.selectedEntities[b.id][a.id]=a,m=a.images,h=0,j=m.length;j>h;h++)e=m[h],f.images[e]=a.label;return f.$emit("entitySelected",a,f.annotation)}for(n=a.images,i=0,k=n.length;k>i;i++)e=n[i],delete f.images[e];return f.$emit("entityDeselected",a,f.annotation)}}]),angular.module("wordlift.editpost.widget.directives.wlClassificationBox",[]).directive("wlClassificationBox",["$log",function(){return{restrict:"E",scope:!0,transclude:!0,template:'<div class="classification-box">\n	<div class="box-header">\n          <h5 class="label">{{box.label}}</h5>\n          <div class="selected-entities">\n            <span ng-class="\'wl-\' + entity.mainType" ng-repeat="(id, entity) in selectedEntities[box.id]" class="wl-selected-item">\n              {{ entity.label}}\n              <i class="wl-deselect-item" ng-click="onSelectedEntityTile(entity, box)"></i>\n            </span>\n            <div class="clear" /> \n          </div>\n        </div>\n  			<div class="box-tiles">\n          <div ng-transclude></div>\n  		  </div>\n      </div>	',link:function(a){return a.currentWidget=void 0,a.isWidgetOpened=!1,a.closeWidgets=function(){return a.currentWidget=void 0,a.isWidgetOpened=!1},a.hasSelectedEntities=function(){return Object.keys(a.selectedEntities[a.box.id]).length>0},a.embedImageInEditor=function(b){return a.$emit("embedImageInEditor",b)},a.toggleWidget=function(b){return a.currentWidget===b?(a.currentWidget=void 0,a.isWidgetOpened=!1):(a.currentWidget=b,a.isWidgetOpened=!0,a.updateWidget(b,a.box.id))}},controller:function(a){var b;return a.tiles=[],a.boxes[a.box.id]=a,a.$watch("annotation",function(){return a.currentWidget=void 0,a.isWidgetOpened=!1}),b=this,b.addTile=function(b){return a.tiles.push(b)},b.closeTiles=function(){var b,c,d,e,f;for(e=a.tiles,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.close());return f}}}}]),angular.module("wordlift.editpost.widget.directives.wlEntityForm",[]).directive("wlEntityForm",["$log",function(){return{restrict:"E",scope:{entity:"=",onSubmit:"&"},template:'<div name="wordlift" class="wl-entity-form">\n<div ng-show="entity.images.length > 0">\n    <img ng-src="{{entity.images[0]}}" />\n</div>\n<div>\n    <label>Entity label</label>\n    <input type="text" ng-model="entity.label" />\n</div>\n<div>\n    <label>Entity type</label>\n    <select ng-model="entity.mainType" ng-options="type.id as type.name for type in supportedTypes" ></select>\n</div>\n<div>\n    <label>Entity Description</label>\n    <textarea ng-model="entity.description" rows="6"></textarea>\n</div>\n<div ng-show="checkEntityId(entity.id)">\n    <label>Entity Id</label>\n    <input type="text" ng-model="entity.id" disabled="true" />\n</div>\n<div class="wl-suggested-sameas-wrapper">\n    <label>Entity Same as (*)</label>\n    <input type="text" ng-model="entity.sameAs" />\n    <h5 ng-show="entity.suggestedSameAs.length > 0">same as suggestions</h5>\n    <div ng-click="setSameAs(sameAs)" ng-class="{ \'active\': entity.sameAs == sameAs }" class="wl-sameas" ng-repeat="sameAs in entity.suggestedSameAs">\n      {{sameAs}}\n    </div>\n</div>\n\n<div class="wl-submit-wrapper">\n  <span class="button button-primary" ng-click="onSubmit()">Save</span>\n</div>\n\n</div>',link:function(a){return a.setSameAs=function(b){return a.entity.sameAs=b},a.checkEntityId=function(a){return/^(f|ht)tps?:\/\//i.test(a)},a.supportedTypes=[{id:"person",name:"http://schema.org/Person"},{id:"place",name:"http://schema.org/Place"},{id:"organization",name:"http://schema.org/Organization"},{id:"event",name:"http://schema.org/Event"},{id:"creative-work",name:"http://schema.org/CreativeWork"},{id:"thing",name:"http://schema.org/Thing"}]}}}]),angular.module("wordlift.editpost.widget.directives.wlEntityTile",[]).directive("wlEntityTile",["$log",function(){return{require:"^wlClassificationBox",restrict:"E",scope:{entity:"=",isSelected:"=",onEntitySelect:"&"},template:'<div ng-class="\'wl-\' + entity.mainType" class="entity">\n        <div class="entity-header">\n    \n          <i ng-click="onEntitySelect()" ng-hide="annotation" ng-class="{ \'wl-selected\' : isSelected, \'wl-unselected\' : !isSelected }"></i>\n          <i ng-click="onEntitySelect()" class="type"></i>\n          <span class="label" ng-click="onEntitySelect()">{{entity.label}}</span>\n\n          <small ng-show="entity.occurrences.length > 0">({{entity.occurrences.length}})</small>\n          <span ng-show="isInternal()">*</span>  \n          <i ng-class="{ \'wl-more\': isOpened == false, \'wl-less\': isOpened == true }" ng-click="toggle()"></i>\n  </div>\n        <div class="details" ng-show="isOpened">\n          <wl-entity-form entity="entity" on-submit="toggle()"></wl-entity-form>\n        </div>\n</div>',link:function(a,b,c,d){return d.addTile(a),a.isOpened=!1,a.isInternal=function(){return a.entity.id.match(/redlink/)?!0:!1},a.open=function(){return a.isOpened=!0},a.close=function(){return a.isOpened=!1},a.toggle=function(){return a.isOpened||d.closeTiles(),a.isOpened=!a.isOpened}}}}]),angular.module("wordlift.editpost.widget.directives.wlEntityInputBox",[]).directive("wlEntityInputBox",function(){return{restrict:"E",scope:{entity:"="},template:"        <div>\n\n          <input type='text' name='wl_entities[{{entity.id}}][uri]' value='{{entity.id}}'>\n          <input type='text' name='wl_entities[{{entity.id}}][label]' value='{{entity.label}}'>\n          <textarea name='wl_entities[{{entity.id}}][description]'>{{entity.description}}</textarea>\n          <input type='text' name='wl_entities[{{entity.id}}][main_type]' value='wl-{{entity.mainType}}'>\n\n          <input ng-repeat=\"type in entity.types\" type='text'\n          	name='wl_entities[{{entity.id}}][type][]' value='{{type}}' />\n          <input ng-repeat=\"image in entity.images\" type='text'\n            name='wl_entities[{{entity.id}}][image][]' value='{{image}}' />\n          <input ng-repeat=\"sameAs in entity.sameAs\" type='text'\n            name='wl_entities[{{entity.id}}][sameas][]' value='{{sameAs}}' />\n\n</div>"}}),angular.module("wordlift.editpost.widget.services.AnalysisService",[]).service("AnalysisService",["configuration","$log","$http","$rootScope",function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(l=function(a){var b;for(null==a&&(a=8),b="";b.length<a;)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},i=function(a,b){return g(g({},a),b)},g=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},h=function(a,b,c){var d,e;for(e in a)if(d=a[e],d.start===b&&d.end===c)return d},j=m={},j._supportedTypes=[],j._defaultType="thing",r=a.classificationBoxes,n=0,p=r.length;p>n;n++)for(f=r[n],s=f.registeredTypes,o=0,q=s.length;q>o;o++)k=s[o],e.call(j._supportedTypes,k)<0&&j._supportedTypes.push(k);return j.createEntity=function(a){var b;return null==a&&(a={}),b={id:"local-entity-"+l(32),label:"",description:"",mainType:"thing",types:[],images:[],confidence:1,occurrences:[],annotations:{}},i(b,a)},j.createAnnotation=function(a){var b;return null==a&&(a={}),b={id:"urn:local-text-annotation-"+l(32),text:"",start:0,end:0,entities:[],entityMatches:[]},i(b,a)},j.parse=function(c){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;r=a.entities;for(j in r)l=r[j],null!=c.entities[j]?b.debug("LocalEntity "+j+" found into the analysis"):(b.debug("Going to add localEntity "+j+" to the analysis"),c.entities[j]=l);s=c.entities;for(j in s)i=s[j],i.label||b.warn("Label missing for entity "+j),i.description||b.warn("Description missing for entity "+j),t=i.mainType,e.call(this._supportedTypes,t)<0&&(b.warn("Schema.org type "+i.mainType+" for entity "+j+" is not supported from current classification boxes configuration"),i.mainType=this._defaultType,b.debug("Schema.org type overridden for entity "+j)),i.id=j,i.occurrences=[],i.annotations={},i.confidence=1;u=c.annotations;for(j in u)for(d=u[j],d.id=j,d.entities={},v=d.entityMatches,k=n=0,p=v.length;p>n;k=++n)g=v[k],c.entities[g.entityId].label||(c.entities[g.entityId].label=d.text,b.debug("Missing label retrived from related annotation for entity "+g.entityId)),c.entities[g.entityId].annotations[j]=d,c.annotations[j].entities[g.entityId]=c.entities[g.entityId];w=c.entities;for(j in w){i=w[j],x=c.annotations;for(f in x){for(d=x[f],m=1,y=d.entityMatches,o=0,q=y.length;q>o;o++)h=y[o],null!=h.entityId&&h.entityId===j&&(m=h.confidence);i.confidence=i.confidence*m}}return c},j.getSuggestedSameAs=function(a){var c;return c=this._innerPerform(a).success(function(a){var b,c,e,f;e=[],f=a.entities;for(c in f)b=f[c],c.startsWith("http")&&e.push(c);return d.$broadcast("sameAsRetrieved",e)}).error(function(a,c){return b.warn("Error on same as retrieving, statut "+c),d.$broadcast("sameAsRetrieved",[])})},j._innerPerform=function(a){return b.info("Start to performing analysis"),b.debug(a),null==a?void b.warn("content missing: nothing to do"):c({method:"post",url:ajaxurl+"?action=wordlift_analyze",data:a})},j.perform=function(a){var c;return c=this._innerPerform(a).success(function(a){return"string"==typeof a?(b.warn("Invalid data returned"),void b.debug(a)):d.$broadcast("analysisPerformed",j.parse(a))}).error(function(a,c){return b.warn("Error on analysis, statut "+c)})},j.preselect=function(c,d){var f,g,i,j,k,l,m,n,o,p;for(p=[],l=0,m=d.length;m>l;l++){f=d[l],k=h(c.annotations,f.start,f.end),null==k&&(b.debug("There is no annotation with start "+f.start+" and end "+f.end),k=this.createAnnotation({start:f.start,end:f.end,text:f.label}),c.annotations[k.id]=k),i=c.entities[f.uri],n=a.entities;for(j in n)g=n[j],o=f.uri,e.call(g.sameAs,o)>=0&&(i=c.entities[g.id]);null!=i?(c.entities[i.id].occurrences.push(k.id),null==c.entities[i.id].annotations[k.id]?(c.entities[i.id].annotations[k.id]=k,c.annotations[k.id].entityMatches.push({entityId:i.id,confidence:1}),p.push(c.annotations[k.id].entities[i.id]=c.entities[i.id])):p.push(void 0)):b.warn("Entity with uri "+f.uri+" is missing both in analysis results and in local storage")}return p},j}]),angular.module("wordlift.editpost.widget.services.EditorService",["wordlift.editpost.widget.services.AnalysisService"]).service("EditorService",["AnalysisService","$log","$http","$rootScope",function(a,c,d,f){var g,h,i,j,k,l;return k=function(a){var c,d,e,f;for(e=b.create(a),d=/<(\w+)[^>]*\sitemid="([^"]+)"[^>]*>([^<]+)<\/\1>/gim,f=[];c=d.exec(a);)f.push({start:e.html2text(c.index),end:e.html2text(c.index+c[0].length),uri:c[2],label:c[3]});return f},j=function(){return tinyMCE.get("content")},i=function(a,b){var c,d;return d=j(),d.dom.addClass(a.id,"disambiguated"),d.dom.addClass(a.id,"wl-"+b.mainType),c=d.dom.getAttrib(a.id,"itemid"),d.dom.setAttrib(a.id,"itemid",b.id),c},h=function(a,b){var c,d;return d=j(),d.dom.removeClass(a.id,"disambiguated"),d.dom.removeClass(a.id,"wl-"+b.mainType),c=d.dom.getAttrib(a.id,"itemid"),d.dom.setAttrib(a.id,"itemid",""),c},g=function(a){var b,c,d,e,f,g,h;if(d=j(),f=[],""===a)return f;for(c=d.dom.select("span.textannotation"),g=0,h=c.length;h>g;g++)b=c[g],e=d.dom.getAttrib(b.id,"itemid"),e===a&&f.push(b.id);return f},f.$on("analysisPerformed",function(a,b){return null!=b&&null!=b.annotations?l.embedAnalysis(b):void 0}),f.$on("embedImageInEditor",function(a,b){return tinyMCE.execCommand("mceInsertContent",!1,'<img src="'+b+'" width="100%" />')}),f.$on("entitySelected",function(a,b,c){var d,e,h,j,k,l,m,n;if(e=[],null!=c)e.push(i(b.annotations[c],b));else{n=b.annotations;for(j in n)d=n[j],e.push(i(d,b))}for(l=0,m=e.length;m>l;l++)h=e[l],h&&(k=g(h),f.$broadcast("updateOccurencesForEntity",h,k));return k=g(b.id),f.$broadcast("updateOccurencesForEntity",b.id,k)}),f.$on("entityDeselected",function(a,b,c){var d,e,i,j,k,l,m,n;if(e=[],null!=c)h(b.annotations[c],b);else{n=b.annotations;for(j in n)d=n[j],h(d,b)}for(l=0,m=e.length;m>l;l++)i=e[l],i&&(k=g(i),f.$broadcast("updateOccurencesForEntity",i,k));return k=g(b.id),f.$broadcast("updateOccurencesForEntity",b.id,k)}),l={createTextAnnotationFromCurrentSelection:function(){var d,e,g,h,i,k,l,m;return e=j(),e.selection.isCollapsed()?void c.warn("Invalid selection! The text annotation cannot be created"):(h=""+e.selection.getSel(),i=a.createAnnotation({text:h}),k='<span id="'+i.id+'" class="textannotation selected">'+e.selection.getContent()+"</span>",e.selection.setContent(k),d=e.getContent({format:"html"}),m=b.create(d),g=d.indexOf(k),l=m.html2text(g),i.start=l,i.end=i.start+h.length,c.debug("New text annotation created!"),c.debug(i),f.$broadcast("textAnnotationAdded",i))},selectAnnotation:function(a){var b,c,d,e,g;for(c=j(),g=c.dom.select("span.textannotation"),d=0,e=g.length;e>d;d++)b=g[d],c.dom.removeClass(b.id,"selected");return f.$broadcast("textAnnotationClicked",void 0),c.dom.hasClass(a,"textannotation")?(c.dom.addClass(a,"selected"),f.$broadcast("textAnnotationClicked",a)):void 0},embedAnalysis:function(){return function(c){var d,f,g,h,i,l,m,n,o,p,q,r,s,t;for(g=j(),n=g.getContent({format:"raw"}),l=k(n),a.preselect(c,l);n.match(/<(\w+)[^>]*\sclass="textannotation[^"]*"[^>]*>([^<]+)<\/\1>/gim,"$2");)n=n.replace(/<(\w+)[^>]*\sclass="textannotation[^"]*"[^>]*>([^<]+)<\/\1>/gim,"$2");p=b.create(n),s=c.annotations;for(f in s)if(d=s[f],0<d.entityMatches.length){for(h='<span id="'+f+'" class="textannotation',t=d.entityMatches,q=0,r=t.length;r>q;q++)i=t[q],m=c.entities[i.entityId],e.call(m.occurrences,f)>=0&&(h+=" disambiguated wl-"+m.mainType+'" itemid="'+m.id);h+='">',p.insertHtml(h,{text:d.start}),p.insertHtml("</span>",{text:d.end})}return o=g.isDirty(),g.setContent(p.getHtml(),{format:"raw"}),g.isNotDirty=!o}}(this)}}]),angular.module("wordlift.editpost.widget.services.ImageSuggestorDataRetrieverService",[]).service("ImageSuggestorDataRetrieverService",["$log","$http","$rootScope",function(){var a;return a={},a.loadData=function(a){var b,c,d,e,f,g,h;e=[];for(c in a)for(b=a[c],h=b.images,f=0,g=h.length;g>f;f++)d=h[f],e.push({uri:d});return e},a}]),angular.module("wordlift.editpost.widget.providers.ConfigurationProvider",[]).provider("configuration",function(){var a,b;return b=void 0,a={setConfiguration:function(a){return b=a},$get:function(){return b}}}),a=jQuery,angular.module("wordlift.editpost.widget",["wordlift.ui.carousel","wordlift.editpost.widget.providers.ConfigurationProvider","wordlift.editpost.widget.controllers.EditPostWidgetController","wordlift.editpost.widget.directives.wlClassificationBox","wordlift.editpost.widget.directives.wlEntityForm","wordlift.editpost.widget.directives.wlEntityTile","wordlift.editpost.widget.directives.wlEntityInputBox","wordlift.editpost.widget.services.AnalysisService","wordlift.editpost.widget.services.EditorService","wordlift.editpost.widget.services.ImageSuggestorDataRetrieverService"]).config(function(a){return a.setConfiguration(window.wordlift)}),a(c=a('<div ng-show="analysis" id="wordlift-edit-post-wrapper" ng-controller="EditPostWidgetController">\n	<div ng-click="createTextAnnotationFromCurrentSelection()" id="wl-add-entity-button-wrapper">\n        <span class="preview button" ng-class="{ \'selected\' : !isSelectionCollapsed }">Add entity</span>\n        <div class="clear" />     \n      </div>\n      \n      <div ng-show="annotation">\n        <h4 class="wl-annotation-label">\n          <i class="wl-annotation-label-icon"></i>\n          {{ analysis.annotations[ annotation ].text }} \n          <small>[ {{ analysis.annotations[ annotation ].start }}, {{ analysis.annotations[ annotation ].end }} ]</small>\n          <i class="wl-annotation-label-remove-icon" ng-click="selectAnnotation(undefined)"></i>\n        </h4>\n        <wl-entity-form entity="newEntity" on-submit="addNewEntityToAnalysis()" ng-show="analysis.annotations[annotation].entityMatches.length == 0"></wl-entity-form>\n      </div>\n\n      <wl-classification-box ng-repeat="box in configuration.classificationBoxes">\n        <div ng-hide="annotation" class="wl-without-annotation">\n          <wl-entity-tile is-selected="isEntitySelected(entity, box)" on-entity-select="onSelectedEntityTile(entity, box)" entity="entity" ng-repeat="entity in analysis.entities | filterEntitiesByTypesAndRelevance:box.registeredTypes"></wl-entity>\n        </div>  \n        <div ng-show="annotation" class="wl-with-annotation">\n          <wl-entity-tile is-selected="isLinkedToCurrentAnnotation(entity)" on-entity-select="onSelectedEntityTile(entity, box)" entity="entity" ng-repeat="entity in analysis.annotations[annotation].entities | filterEntitiesByTypes:box.registeredTypes"" ></wl-entity>\n        </div>  \n      </wl-classification-box>\n      <div wl-carousel>\n        <div ng-repeat="(image, label) in images" class="wl-card" wl-carousel-pane>\n          <img ng-src="{{image}}" />\n        </div>\n      </div>\n      \n      <div class="wl-entity-input-boxes">\n        <wl-entity-input-box annotation="annotation" entity="entity" ng-repeat="entity in analysis.entities | isEntitySelected"></wl-entity-input-box>\n        <div ng-repeat="(box, entities) in selectedEntities">\n          <input type=\'text\' name=\'wl_boxes[{{box}}][]\' value=\'{{id}}\' ng-repeat="(id, entity) in entities">\n        </div> \n      </div>   \n    </div>').appendTo("#wordlift-edit-post-outer-wrapper"),d=angular.bootstrap(a("#wordlift-edit-post-wrapper"),["wordlift.editpost.widget"]),tinymce.PluginManager.add("wordlift",function(a){return a.onLoadContent.add(function(){return d.invoke(["AnalysisService","$rootScope",function(c,d){return d.$apply(function(){var d,e;return d=a.getContent({format:"raw"}),e=b.create(d).getText(),c.perform(e)})}])}),a.onNodeChange.add(function(a){return d.invoke(["$rootScope",function(b){return b.$apply(function(){return b.$broadcast("isSelectionCollapsed",a.selection.isCollapsed())})}])}),a.onClick.add(function(a,b){return d.invoke(["EditorService","$rootScope",function(a,c){return c.$apply(function(){return a.selectAnnotation(b.target.id)})}])})}))}).call(this);
//# sourceMappingURL=wordlift-reloaded.3.0.0-beta.min.map